window.lpTag=window.lpTag||{};lpTag.CookieMethods=function CookieMethods(a){if(a){this.separator=a;}};lpTag.CookieMethods.prototype.separator="::";lpTag.CookieMethods.prototype.readCookie=function(b){if(!b){return"";}b=encodeURIComponent(b);var a=document.cookie.split(b+"=");if(a.length==1){return"";}return decodeURIComponent(a[1].split(";")[0]);};lpTag.CookieMethods.prototype.writePersistentCookie=function(a,b,c){c=typeof c=="number"?(c):(3600*24*30);return this.writeSessionCookie(a,b,c);};lpTag.CookieMethods.prototype.addToCookie=function(a,b,d){var c=this.readCookie(a);c+=this.separator+b;return typeof d==="number"?this.writeSessionCookie(a,c,d):this.writePersistentCookie(a,c,d);};lpTag.CookieMethods.prototype.writeSessionCookie=function(b,c,d){if(!b){return false;}if(c===null||c===undefined){d=-1;}if(typeof d==="number"){var a=new Date();a.setDate(a.getTime()+(d*1000));}c=c?encodeURIComponent(c):"";document.cookie=[encodeURIComponent(b),"=",c,(a?"; expires="+a.toUTCString():""),"; path=/"].join("");return true;};lpTag.CookieMethods.prototype.clearCookie=function(a){return this.writeSessionCookie(a);};window.lpTag=window.lpTag||{};lpTag.StorageMethods=function StorageMethods(){var b=false,c="lpTestCase";try{b=(typeof Storage!=="undefined")&&this.setSessionData(c,"1");this.removeSessionData(c);}catch(a){}this.isStorageEnabled=function(){return b;};};lpTag.StorageMethods.prototype.setSessionData=function(a,b){sessionStorage.setItem(a,b);return true;};lpTag.StorageMethods.prototype.getSessionData=function(a){return sessionStorage.getItem(a)||"";};lpTag.StorageMethods.prototype.removeSessionData=function(a){if(this.getSessionData(a)){sessionStorage.removeItem(a);return true;}return false;};lpTag.StorageMethods.prototype.setPersistentData=function(a,b){localStorage.setItem(a,b);return true;};lpTag.StorageMethods.prototype.getPersistentSessionData=function(a){return localStorage.getItem(a)||"";};lpTag.StorageMethods.prototype.removePersistentData=function(a){if(this.getPersistentSessionData(a)){localStorage.removeItem(a);return true;}return false;};window.lpTag=window.lpTag||{};lpTag.SessionDataManager=function(){var b="::",g={},f={};var h,a,e=this,d=false;if(this===window){return;}h=new lpTag.StorageMethods();a=new lpTag.CookieMethods();d=h.isStorageEnabled();function c(k){if(lpTag&&lpTag.log){lpTag.log(k,"ERROR","SessionData");}}function j(n,q,p,r){var m=false;if(typeof q!=="object"){try{var l=r?e.getPersistentSessionData(n):e.getSessionData(n);var o=l!==""?l.split(b):[];o.push(q);l=o.join(b);m=r?e.setPersistentData(n,l,p):e.setSessionData(n,l);}catch(k){c((r?"appendToPersistentData ":"appendToSessionData ")+" failed, key: "+n);}}return m;}function i(q,p,l,n){var m=false;if(typeof p!=="object"){try{var r=f?e.getPersistentSessionData(q):e.getSessionData(q);var o=r!==""?r.split(b):[];var t=[];for(var k=0;k<o.length;k++){if(o[k]!==p){t.push(o[k]);}}r=t.join(b);if(r!==""){m=l?e.setPersistentData(q,r,n):e.setSessionData(q,r);}else{m=l?e.removePersistentData(q):e.removeSessionData(q);}}catch(s){c((l?"removePartialPersistentData ":"removePartialSessionData ")+" failed, key: "+q);}}return m;}this.readCookie=function(k){return a.readCookie(k);};this.setSessionData=function(l,m){m=this.stringifyValue(m);try{if(!g[l]){g[l]=l;}if(d){h.setSessionData(l,m);}else{a.writeSessionCookie(l,m);}}catch(k){c("Error in setSessionData, data: "+l);}};this.getSessionData=function(l){try{return this.parseValue(d?h.getSessionData(l):a.readCookie(l));}catch(k){c("Error in getSessionData, data: "+l);}};this.stringifyValue=function(l){try{if(typeof l==="object"){l=JSON.stringify(l);}}catch(k){}return l;};this.parseValue=function(l){try{l=JSON.parse(l);}catch(k){}return l;};this.getPersistentSessionData=function(l){try{return this.parseValue(d?h.getPersistentSessionData(l):a.readCookie(l));}catch(k){c("Error in getPersistentSessionData, data: "+l);}};this.appendToSessionData=function(k,l){j(k,l,false);};this.appendToPersistentData=function(k,m,l){j(k,m,true,l);};this.removePartialPersistentData=function(k,l){i(k,l,true);};this.removeSessionData=function(k){d?h.removeSessionData(k):a.clearCookie(k);};this.removePersistentData=function(k){d?h.removePersistentData(k):a.clearCookie(k);};this.removePartialSessionData=function(k,l){i(k,l,false);};this.setPersistentData=function(l,n,m){n=this.stringifyValue(n);try{if(!f[l]){f[l]=l;}if(d){h.setPersistentData(l,n);}else{a.writePersistentCookie(l,n,m);}}catch(k){c("Error in setPersistentData, data: "+l);}};this.clearPersistentData=function(l){l=l||f;for(var m in l){try{if(d){h.removePersistentData(l[m]);}else{a.clearCookie(l[m]);}}catch(k){c("Error in clearPersistentData, key: "+l[m]);}}};this.clearSessionData=function(l){l=l||g;for(var m in l){try{if(d){h.removeSessionData(l[m]);}else{a.clearCookie(l[m]);}}catch(k){c("Error in SessionData in clearSessionData, key:"+l[m]);}}};};window.lpTag=window.lpTag||{};lpTag.taglets=lpTag.taglets||{};lpTag.utils=lpTag.utils||{};window.lpTag.utils.SessionDataAsyncWrapper=function(a){if(this===window){return null;}var d=a.useSecureStorage;var l=a.lpNumber;var f=d&&a.secureStorageLocation&&(lpTag.taglets&&lpTag.taglets.secureStorage)?true:false;if(lpTag.SessionDataManager){lpTag.utils.sessionDataManager=lpTag.utils.sessionDataManager||new lpTag.SessionDataManager();}var g=lpTag.utils.sessionDataManager||null;var e=lpTag.taglets&&lpTag.taglets.secureStorage;var c=a.secureStorageLocation?a.secureStorageLocation:"";function b(o,q,m,n){var p;if(f){e.getValue({key:o,site:l,success:h(o,q,n),error:h(o,m,n),context:n,domain:c});}else{p=g.getSessionData(o);if(typeof p!=="undefined"){j(q,p,n);}else{j(m,p,n);}}}function k(p,q,r,m,o,n){if(f){e.setValue({key:p,value:q,site:l,success:r?h(p,r,o):null,error:m?h(p,m,o):null,context:o,domain:c,storeSecurely:n});}else{if(g.setSessionData(p,q)){j(r,true,o);}else{j(m,false,o);}}}function i(o,p,m,n){if(f){e.setValue({key:o,site:l,success:p?h(o,p,n):null,error:m?h(o,m,n):null,context:n,domain:c,expires:-1});}else{if(g.removeSessionData(o)){j(p,true,n);}else{j(m,false,n);}}}function h(n,o,m){return function(p){if(p&&typeof p==="object"){p=p[n];}j(o,p,m);};}function j(p,o,n){try{if(p&&typeof p==="function"){p.call(n,o);}}catch(m){}}this.setSessionData=k;this.getSessionData=b;this.removeSessionData=i;this.readCookie=lpTag.utils.sessionDataManager&&lpTag.utils.sessionDataManager.readCookie;this.usingSecureStorage=f;};window.lpTag=window.lpTag||{};lpTag.utils=lpTag.utils||{};lpTag.utils.Events=lpTag.utils.Events||function(f){if(this===window){return false;}var b=0;var k={};var d={};var a=[];var i="evId_";var j=0;var g=(f&&typeof f.cloneEventData==="boolean"?f.cloneEventData:false);var l=(f&&!isNaN(f.eventBufferLimit)?f.eventBufferLimit:-1);function h(o,n,m){if(lpTag&&lpTag.utils&&lpTag.utils.log){lpTag.utils.log(o,n,m);}}k.once=function(m){if(m){m.triggerOnce=true;this.register(m);}else{return null;}};k.register=function(q){if(!q.eventName||!q.func||(typeof q.func!=="function"&&q.func.constructor!==Array)){h("Ev listen has invalid params: evName=["+q.eventName+"]  fn=["+q.func+"]","ERROR","Events");return null;}if(q.func.constructor===Array){var m=[],n,s;for(var p=0;p<q.func.length;p++){n=c(q);n.func=q.func[p];s=this.register(n);m.push(s);}return m;}var r=i+(b++);var o={id:r,func:q.func,context:q.context||null,aSync:q.aSync?true:false,appName:q.appName||"*",triggerOnce:q.triggerOnce||false};d[q.eventName]=d[q.eventName]||[];d[q.eventName].push(o);h("Ev listen rgstr: evName=["+q.eventName+"]  fn=["+q.func+"] aSync="+o.aSync+" appName="+o.name,"DEBUG","Events");q=null;return r;};k.bind=k.register;k.unbind=function(r){var m=false;var q;if(r&&typeof r==="string"){return k.unregister(r);}else{if(!r||(!r.func&&!r.context&&!r.appName)){return m;}}var p=d;if(r.eventName){p={};p[r.eventName]=d[r.eventName];}for(var n in p){if(p.hasOwnProperty(n)){q=o(p[n],r.func,r.context,r.appName);if(q.length!==p[n].length){d[n]=q;m=true;}}}return m;function o(A,v,t,y){var z=[];for(var x=0;x<A.length;x++){try{var D=(!t&&A[x].func===v);var C=(!v&&t&&A[x].context===t);var s=(v&&t&&A[x].func===v&&A[x].context===t);var u=(!t&&!v&&y&&y==A[x].appName);var B=(A[x].appName=="*");if((D||C||s)){if(u||B){continue;}}else{if(u){continue;}}z.push(A[x]);}catch(w){h("Error in unbind","ERROR","Events.unbind");}}return z;}};k.unregister=function(p){var n=false;if(!p){h("Ev listen id not spec for unregister","ERROR","Events");return null;}for(var m in d){if(d.hasOwnProperty(m)){for(var o=0;o<d[m].length;o++){if(d[m][o].id==p){d[m].splice(o,1);h("Ev listen="+p+" and name="+m+" unregister","DEBUG","Events");n=true;break;}}}}if(!n){h("Ev listen not found "+p+" unregister","DEBUG","Events");}return n;};k.hasFired=function(p){if(typeof(p.eventName)=="undefined"||p.eventName=="*"){return a;}var m=[];for(var o=0;o<a.length;o++){if(a[o].eventName==p.eventName){if((p.appName&&p.appName==a[o].appName)||(!a[o].appName||a[o].appName=="*")){m.push(a[o]);}}}return m;};k.publish=function(m){if(!m||typeof(m.eventName)=="undefined"){h("Ev name not spec for publish","ERROR","Events");m=null;return null;}m.data=m.data||{};m.passDataByRef=m.passDataByRef||!g;e(m);var t=false;if(!d[m.eventName]){return false;}var r=[];for(var s=0;s<d[m.eventName].length;s++){if((!m.appName||d[m.eventName][s].appName=="*")||d[m.eventName][s].appName==m.appName){r.push(d[m.eventName][s]);t=true;}}if(t&&r.length>0){for(var q=0;q<r.length;q++){var u=m.passDataByRef?m.data:c(m.data);try{var n=r[q];if(n.aSync||u.aSync){setTimeout(p(n,u),0);}else{n.func.call(n.context,u);u=null;if(n.triggerOnce){k.unbind(n);}n=null;}}catch(o){h("Error executing "+m.eventName+" eventId: "+n.id,"ERROR","Events");}h("Ev listen ev="+m.eventName+" exec listenersFound="+t,"DEBUG","Events");}}m=null;return t;function p(w,v){return function(){w.func.call(w.context,v);v=null;if(w.triggerOnce){k.unbind(w);}w=null;};}};k.trigger=k.publish;return k;function e(m){if(l===0||(m.data&&!!m.data.doNotStore)){m=null;return;}var n={eventName:m.eventName,appName:m.appName};n.data=m.passDataByRef?m.data:c(m.data);if(l>0){if(j>=l){j=0;}a[j]=n;j++;}else{a.push(n);}m=null;}function c(n){var m={};if(n.constructor===Object){for(var o in n){if(n.hasOwnProperty(o)&&n[o]!==null&&n[o]!==undefined){if(typeof n[o]==="object"&&n[o].constructor!==Array){m[o]=c(n[o]);}else{if(n[o].constructor===Array){m[o]=n[o].slice(0)||[];}else{if(typeof n[o]!=="function"){m[o]=n[o]!==null&&n[o]!==undefined?n[o]:"";}}}}}}else{if(n.constructor===Array){m=n.slice(0)||[];}else{if(typeof n!=="function"){m=n;}}}return m;}};window.lpTag=window.lpTag||{};lpTag.RelManager=lpTag.RelManager||function(a){if(this===window){e("RelManager called without new","ERROR","lpTag.RelManager");return null;}var k=true;var h=this;var m=null;var i="";var d={domain:"",lpNumber:"",appKey:"",accessToken:""};var c=["xhr","postmessage","rest2jsonp"];if(a&&a.constructor===Array){c=a;}function e(p,o,n){if(lpTag&&lpTag.utils&&lpTag.utils.log){lpTag.utils.log(p,o,n);}}this.clearData=function(){for(var n in d){d[n]="";}m=null;i="";};this.setData=function(n){m={};i="";for(var o in n){if(n.hasOwnProperty(o)){d[o]=n[o];}}if(n&&typeof n.useJSON==="boolean"){k=n.useJSON;}if(n.transportOrder){c=n.transportOrder;}n=null;};this.addRels=function(o,r){o=f(o);if(!r){o=null;return null;}m[r.type]=m[r.type]||{};var q=m[r.type];if(r.id){q[r.id]=q[r.id]||{};q=q[r.id];}for(var n in o){if(o.hasOwnProperty(n)){if(o[n]["rel"]){q[o[n]["rel"]]=o[n]["href"];}else{if(o[n]["@rel"]){q[o[n]["@rel"]]=o[n]["@href"];}}}}if(r.data){q.data=q.data||{};for(var p in r.data){if(r.data.hasOwnProperty(p)){q.data[p]=r.data[p];}}}o=null;r=null;q=null;};this.removeRels=function(o){var n=false;if(!o){return null;}if(o.id){if(m[o.type]&&m[o.type][o.id]){m[o.type][o.id]=null;delete m[o.type][o.id];n=true;}}else{if(m[o.type]){m[o.type]=null;delete m[o.type];n=true;}}o=null;return n;};this.hasRel=function(o,p){var n=this.getURI(o,p);p=null;return(n!==null&&n!=="");};this.getURI=function(n,r){if(!r||!m){return null;}var p=null;var q;if(m[r.type]){q=m[r.type];if(r.id&&q[r.id]){q=q[r.id];}}if(q){p=q[n]||null;if(!p&&q.data){for(var o in q.data){if(q.data.hasOwnProperty(o)){p=this.getURI(n,{type:o,id:q.data[o],needAuth:r.needAuth});if(p){break;}}}}if(!r.ignoreParameters){p=p?g(p,r.needAuth||false):"";}}r=null;q=null;return p;};function g(o,n){if(o.indexOf("v=1")<0){o+=o.indexOf("?")>-1?"&":"?";o+="v=1";}if(n&&o.indexOf("&NC=true")<0){o+="&NC=true";}return o;}function j(n){if(k&&n.toLowerCase().indexOf(".json")<0){var o=n.indexOf("?");if(o>0){n=n.replace("?",".json?");}else{n+=".json";}}return n;}this.buildRequestObj=function(n){var o=b(n);if(!o){n=null;o=null;return null;}if(n.queryParams&&o.url){o.url=n.queryParams?o.url+l(n.queryParams):o.url;}o.transportOrder=c.slice(0);n=null;return o;};function l(p){var n="";for(var q in p){if(p.hasOwnProperty(q)){if(p[q].constructor===Array){for(var o=0;o<p[q].length;o++){n+="&"+encodeURIComponent(q)+"="+encodeURIComponent(p[q][o]);}}else{n+="&"+encodeURIComponent(q)+"="+encodeURIComponent(p[q]);}}}p=null;return n;}function f(p){var n=[];for(var o in p){if(p.link){n=p.link.constructor===Array?p.link:[p.link];p=null;return n;}if(p.hasOwnProperty(o)&&n.length===0){if(o==="link"){n=p[o].constructor===Array?p[o]:[p[o]];p=null;return n;}else{if(p[o]!==null&&p[o]!==undefined&&typeof p[o]==="object"&&p[o].constructor!==Array){n=f(p[o]);}}}}p=null;return n;}this.extractRels=f;function b(p){var n={AUTHORIZATION:"LivePerson appKey="+d.appKey};if(d.accessToken){n={AUTHORIZATION:"Bearer "+d.accessToken};}var o={url:"",method:"",headers:"",data:""};if(!p.url){o.url=(p.rel==="")?"https://"+d.domain+"/api/account/"+d.lpNumber+"?v=1":h.getURI(p.rel,{type:p.type,id:p.id,needAuth:p.needAuth});}else{o.url=p.url;}if(o.url){o.url=j(o.url);}o.method=p.requestType||"GET";o.headers=n;n=null;if(o.method==="PUT"){o.headers["X-HTTP-Method-Override"]="PUT";o.method="POST";}if(o.method==="DELETE"){o.headers["X-HTTP-Method-Override"]="DELETE";o.method="POST";}if(p.data){o.data=p.data;}p=null;if(o.url){return o;}else{return null;}}this.setBaseUrl=function(n){var o=(n.indexOf("http://")>-1)||(n.indexOf("https://")>-1);i=o?n:"https://"+n;};};window.lpTag=window.lpTag||{};lpTag.taglets=lpTag.taglets||{};lpTag.taglets.lpAjax=(function(f){var h="1.0.3";var a="lpAjax";var c={};var e=false;function l(){e=true;}var b=function(n,o){c[n]=o;};function g(o,n){if(f.lpTag&&lpTag.log){lpTag.log(o,n,a);}}function j(o){if(!e){l();}var n="unknown";try{var q=m(o);if(q){q.issueCall(o);return true;}else{o.error.call(o.context||null,{responseCode:602,error:"Transport - "+n+" - unable to issueCall request: "+o.url+" e="+p,body:"ERROR"});}}catch(p){g("general exception in calling transport: "+p,"ERROR");if(typeof o.error=="function"){if(q&&q.getName){n=q.getName();}try{o.error.call(o.context||null,{responseCode:602,error:"Transport - "+n+" - unable to issueCall request: "+o.url+" e="+p,body:"ERROR"});}catch(p){g("Exception in execution of ERROR callback, type :"+n+" e=["+p.message+"]","ERROR");}}}}function d(p){if(!e){l();}for(var n in p){var o=c[n];if(o){o.configure(p[n]);}}}function m(r){var n=false,o=-1;for(var q=0;q<r.transportOrder.length;q++){if(!n){var s=i({},r);var p=c[s.transportOrder[q]];if(p&&p.isValidRequest&&p.isValidRequest(s)){n=true;o=q;}}}if(n){return c[s.transportOrder[o]];}else{return null;}}function k(t,s,r){if(t==null){return;}var q=Array.prototype.forEach;if(q&&t.forEach===q){t.forEach(s,r);}else{if(t.length===+t.length){for(var p=0,n=t.length;p<n;p++){if(p in t&&s.call(r,t[p],p,t)==={}){return;}}}else{for(var o in t){if(Object.prototype.hasOwnProperty.call(t,o)){if(s.call(r,t[o],o,t)==={}){return;}}}}}}function i(n){k(Array.prototype.slice.call(arguments,1),function(o){for(var p in o){n[p]=o[p];}});return n;}return{getVersion:function(){return h;},getName:function(){return a;},init:l,issueCall:j,configureTransports:d,addTransport:b};})(window);window.lpTag=window.lpTag||{};lpTag.taglets=lpTag.taglets||{};lpTag.taglets.postmessage=lpTag.taglets.postmessage||(function(aj){var z="1.0.6";var U="postmessage";var w=true;var x={};var s={};var d={};var H=0;var o=0;var u=0;var a=0;var R={};var M;var ag=!!(aj.addEventListener);var aq=false;var K=[];var y={DEBUG:"DEBUG",INFO:"INFO",ERROR:"ERROR"};var b=ab(document.location.href);var I={progress:"progressLoad",completed:"completeLoad",error:"errorLoad",reloading:"reloading"};var h={responseType:I.error,responseCode:404,message:"Request timed out on parent postMessage layer",name:"TIMEOUT"};var ae={responseType:I.success,responseCode:200,message:"iFrame has successfully loaded",name:"OK"};var Z={responseType:I.error,responseCode:418,message:"This iFrame is a teapot, not very useful for communication but lovely for earl grey",name:"TEAPOT"};var av={timeout:60000};ar();D(aj,"message",v);var J={VALIDATED:"valid",PENDING:"pending",FAILED:"failed"};function D(ax,aw,ay){if(ax.addEventListener){ax.addEventListener(aw,ay,false);}else{ax.attachEvent("on"+aw,ay);}}function t(ax,aw){return{callId:ax,responseType:aw.responseType,responseCode:aw.responseCode,error:{message:aw.message,id:aw.responseCode,name:aw.name}};}function X(ax,aw,ay){if(ax.removeEventListener){ax.removeEventListener(aw,ay,false);}else{if(ax.detachEvent){ax.detachEvent("on"+aw,ay);}}}function ar(){var aw;if((document.readyState=="interactive"||document.readyState=="complete")&&document.body){aq=true;}else{if(ag){aw=function(){aq=true;T();X(document,"DOMContentLoaded",aw);};D(document,"DOMContentLoaded",aw);}else{aw=function(){if((document.readyState=="interactive"||document.readyState=="complete")&&document.body){aq=true;T();X(document,"readystatechange",aw);}};D(document,"readystatechange",aw);}}}function T(){while(K.length>0){try{(K.shift()).call(null);}catch(aw){i("Unable to execute queued callbacks for window interactive state",y.ERROR,"runFrameAttachPendingQueue");}}}function L(aw){return aw+"_"+Math.floor(Math.random()*100000)+"_"+Math.floor(Math.random()*100000);}function ab(aw){var az=new RegExp(/(http{1}s{0,1}?:\/\/)([^\/\?]+)(\/?)/ig);var ay,ax=null;if(aw.indexOf("http")===0){ay=az.exec(aw);}else{ay=az.exec(aj.location.href);}if(ay&&ay.length>=3&&ay[2]!==""){ax=ay[1].toLowerCase()+ay[2].toLowerCase();}return ax;}function p(ax,az){var aw=false,ay,aA;if(!ax||!ax.url){i("iFrame configuration empty or missing url parameter",y.ERROR,"addiFrameLocation");return aw;}ay=ab(ax.url);aA=(ax.url.toLowerCase().indexOf("https")===0);if(!x[ay]&&!R[ay]){if(aA===az){R[ay]=ax;aw=true;}}return aw;}function O(aw){var ax=ab(aw.url);if(x[ax]){return Y(ax,aw.callback||aw.success,aw.context);}var ay=L("fr");x[ax]={elem:S(ay),url:aw.url,validated:J.PENDING,defaults:aw.defaults||{},delayLoad:isNaN(aw.delayLoad)?0:aw.delayLoad,requestCount:0,success:aw.callback||aw.success,error:aw.error,maxReloadRetries:aw.maxReloadRetries||3,reloadInterval:aw.reloadInterval*1000||30000};setTimeout(function(){F(aw.url,ax);},x[ax].delayLoad);i("iFrame Queued to load "+ax,y.INFO,"addFrame");return J.PENDING;}function F(ax,aw){if(!x[aw].loadCallback){B(aw);}if(aq){ap(ax,aw);}else{K.push(function(){ap(ax,aw);});}}function ap(ax,aw){g(x[aw].elem,ax);D(x[aw].elem,"load",x[aw].loadCallback);x[aw].iFrameOnloadTimeout=setTimeout(x[aw].loadCallback,5000);document.body.appendChild(x[aw].elem);}function B(aw){x[aw].loadCallback=function(ax){if(x[aw].iFrameOnloadTimeout){clearTimeout(x[aw].iFrameOnloadTimeout);delete x[aw].iFrameOnloadTimeout;}al(aw,ax);};}function ai(){H=H+1;u=u+1;}function au(ax,aw){d[ax]=d[ax]||[];d[ax].push(aw);a=a+1;return true;}function Y(ay,az,ax){var aw=ac(ay);am(az,ax,aw);return x[ay].validated;}function S(ax){var aw=document.createElement("IFRAME");aw.setAttribute("id",ax);aw.setAttribute("name",ax);aw.style.width="0px";aw.style.height="0px";aw.style.position="absolute";aw.style.top="-1000px";aw.style.left="-1000px";return aw;}function l(aA,aC,ax,aw,ay,aB){var az=false;if(aA&&aC&&typeof aC==="function"){s[aA]={success:aC,error:ax,progress:aw,ctx:ay,launchTime:new Date(),timeout:(aB+1000)||av.timeout};az=true;}return az;}function j(aw){if(s[aw]){s[aw]=null;delete s[aw];return true;}return false;}function al(ax,aw){i("onload validation called "+ax,y.INFO,"validateFrame");var ay=function(az){at(az,ax);};if(aw&&aw.error){at(aw,ax);}else{setTimeout(function(){m({domain:ax,success:ay,error:ay,validation:true,timeout:100,retries:-1,defaults:x[ax].defaults});},500);}return true;}function at(ay,ax){var aw;var az=x[ax];i("running validation of domain "+ax,y.INFO,"validateFrameCallback");if(az){x[ax].validated=ay&&ay.error?J.FAILED:J.VALIDATED;aw=(x[ax].validated===J.VALIDATED);if(aw){n(ax,ay);}else{if(x[ax].reloadObj&&x[ax].reloadObj.retriesLeft>0){ao(ax);}else{P(ax);}}}az=null;return aw;}function n(ax,aw){i("FrameLoaded "+ax,y.INFO,"runFrameValidated");if(aw&&aw.info&&aw.info.defaults){x[ax].defaults=aw.info.defaults;}ae.domain=ax;am(x[ax].success,x[ax].context,ae);C(ax);f(ax,true);}function P(ax){i("iFrame is a teapot "+ax,y.ERROR,"runFrameFailedToLoad");if(x[ax].error){var aw=t(0,Z);aw.domain=ax;am(x[ax].error,x[ax].context,aw);}c(ax);f(ax,false);}function ao(aw){i("Retry "+aw,"info","runReloadAttempt");f(aw,false);E({origin:aw});}function f(ax,aw){i("Running buffer queue : "+ax+" loaded: "+aw,y.INFO,"runQueuedRequests");if(d[ax]&&d[ax].length>0){do{var ay=d[ax].shift();if(aw){m(ay);}else{am(ay.error,ay.context,{responseCode:600,error:"Transport - postmessage - unable to run request: "+ax,body:"ERROR"});}}while(d[ax].length>0);d[ax]=null;delete d[ax];}}function c(aw){i("Cleaning up failed iFrame: "+aw,y.INFO,"cleanupIFrame");if(x[aw]){X(x[aw].elem,"load",x[aw].loadCallback);x[aw].elem.parentNode.removeChild(x[aw].elem);x[aw]=null;delete x[aw];}}function ad(ax,ay,aw){i("Frame not found for domain: "+ax,y.ERROR,"noFrameFound");am(ay,{responseCode:600,error:"Transport - postmessage - unable to run request: "+ax,body:"ERROR"},aw);return false;}function A(ax){var aw=false;if(aj.postMessage&&aj.JSON){if(ax&&ax.success&&((ax.domain&&ax.validation)||ax.url)){ax.domain=ax.domain||ab(ax.url);if(x[ax.domain]||R[ax.domain]){aw=true;}}}return aw;}function m(ax){var aw=false;if(w&&A(ax)){if(x[ax.domain]){if(x[ax.domain].validated===J.PENDING&&!ax.validation){aw=au(ax.domain,ax);a=a+1;}else{aw=N(ax);if(aw){ai();}else{s[ax.callId].timeout=0;}}}else{i("Adding iFrame to DOM - first request: "+ax.domain,y.INFO,"issueCall");aw=au(ax.domain,ax);O(R[ax.domain]);delete R[ax.domain];}}else{aw=ad(ax.domain,ax.error,ax.context);}return aw;}function N(ax){var aw,aA=false;ax=e(ax);aw=aa(ax);aw=JSON.stringify(aw);i("sending msg to domain "+ax.domain,y.DEBUG,"sendRequest");var ay=(ax.timeout*(ax.retries+1))+2000;l(ax.callId,ax.success,ax.error,ax.progress,ax.context,ay);try{aA=W(ax.domain,aw);M=setTimeout(r,1000);}catch(az){i("Error trying to send message",y.ERROR,"sendMessageToFrame");aA=false;}return aA;}function e(aw){aw.callId=L("call");aw.returnDomain=b;if(aw.progress){aw.fireProgress=true;}aw.headers=aw.headers||{};aw.headers["LP-URL"]=aj.location.href;return aw;}function W(az,ax){var aw=false;try{x[az].elem.contentWindow.postMessage(ax,az);x[az].requestCount=x[az].requestCount+1;aw=true;}catch(ay){i("Error trying to send message",y.ERROR,"sendMessageToFrame");}return aw;}function r(){if(M){clearTimeout(M);}M=null;var aw=new Date();var aA=0;var aB=[];for(var ay in s){if(s.hasOwnProperty(ay)&&s[ay].launchTime){var az=aw-s[ay].launchTime;if(az>s[ay].timeout){aB.push(ay);}else{aA=aA+1;}}}if(aB.length){i("Checking errors found "+aB.length+" timeout callbacks to call",y.DEBUG,"checkForErrors");for(var ax=0;ax<aB.length;ax++){G(t(aB[ax],h));}}if(aA>0){M=setTimeout(r,1000);}return true;}function aa(ay){var az={};if(ay.constructor===Object){for(var ax in ay){try{if(ay.hasOwnProperty(ax)&&typeof ay[ax]!=="function"){az[ax]=ay[ax];}}catch(aw){i("Error creating request object data clone",y.ERROR,"cloneSimpleObj");}}}else{if(ay.constructor===Array){az=ay.slice(0)||[];}else{if(typeof ay!=="function"){az=ay;}}}return az;}function G(aB,ay){if((aB.callId&&s[aB.callId])||aB.responseType===I.reloading){var ax=s[aB.callId];var aA,aw=false;try{switch(aB.responseType){case I.completed:aA=ax.success;aw=true;break;case I.error:aA=ax.error;aw=true;o=o+1;break;case I.progress:aA=ax.progress;break;case I.reloading:aB.origin=ay;aA=E;break;}if(aw){j(aB.callId);an(aB);u=u>0?0:u-1;}if(aA&&typeof aA==="function"){am(aA,(ax&&ax.ctx)||null,aB);}aA=null;ax=null;}catch(az){i("Error in executing callback","ERROR","runCallback");return false;}}return true;}function E(aw){i("Got reload request from "+aw.origin,y.DEBUG,"handleReloadState");x[aw.origin].validated=J.PENDING;if(!x[aw.origin].reloadObj){i("Creating reloadObj"+aw.origin,y.DEBUG,"handleReloadState");x[aw.origin].reloadObj=k(aw.origin);}Q(aw.origin);}function Q(aw){i("Reload try for domain "+aw+" ,retries left "+x[aw].reloadObj.retriesLeft,y.DEBUG,"reloadIFrame");x[aw].reloadObj.retriesLeft=x[aw].reloadObj.retriesLeft-1;if(x[aw].reloadObj.setLocationTimeout){clearTimeout(x[aw].reloadObj.setLocationTimeout);}if(x[aw].reloadObj.retry){x[aw].reloadObj.setLocationTimeout=setTimeout(q(aw),x[aw].reloadInterval);}else{x[aw].reloadObj.retry=true;q(aw)();}}function q(aw){return function(){x[aw].iFrameOnloadTimeout=setTimeout(function(){al(aw,{error:{code:404,message:"Frame did not trigger load"}});},5000);g(x[aw].elem,x[aw].url);};}function g(aw,ax){ax+=(ax.indexOf("?")>0?"&bust=":"?bust=");ax+=new Date().getTime();i("Setting iFrame to URL: "+ax,y.INFO,"setIFrameLocation");aw.setAttribute("src",ax);}function k(aw){i("Creating reload object "+aw,y.INFO,"createReloadObject");var ax=x[aw].maxReloadRetries;return{retriesLeft:ax};}function C(aw){i("Cleaning up reload object for this instance"+aw,y.INFO,"cleanUpReloadObject");if(x[aw].reloadObj){if(x[aw].reloadObj.setLocationTimeout){clearTimeout(x[aw].reloadObj.setLocationTimeout);}x[aw].reloadObj=null;delete x[aw].reloadObj;}}function an(ay){var ax=["callId","responseType"];for(var aw=0;aw<ax.length;aw++){ay[ax[aw]]=null;delete ay[ax[aw]];}}function ac(ax){var aw;if(x[ax]){aw={domain:ax,url:x[ax].url,validated:x[ax].validated,requestCount:x[ax].requestCount,defaults:x[ax].defaults,started:(x[ax].validated===J.VALIDATED)};}return aw;}function ak(){var aw={};for(var ax in x){if(x.hasOwnProperty(ax)){aw[x[ax].domain]=ac(x[ax].domain);}}return aw;}function am(ay,aw,az){if(ay&&typeof ay==="function"){try{ay.call(aw||null,az);}catch(ax){i("Error in executing callback",y.ERROR,"runCallback");}}}function v(ay){var ax,az;try{az=ay.origin;if(!x[az]){return;}ax=JSON.parse(ay.data);if(ax.body&&typeof ax.body==="string"){try{ax.body=JSON.parse(ax.body);}catch(aw){i("Error in parsing message body from frame, origin: "+az,y.DEBUG,"handleMessageFromFrame");}}}catch(aw){ax=null;i("Error in handling message from frame, origin: "+az,y.ERROR,"handleMessageFromFrame");}if(ax&&(ax.callId||ax.responseType===I.reloading)){G(ax,az);}}function i(ay,ax,aw){if(aj.lpTag&&lpTag.log){lpTag.log(ay,ax,aw);}}function V(aw){var az=(location.protocol.indexOf("https")===0);if(aw){if(aw.frames){aw.frames=aw.frames.constructor===Array?aw.frames:[aw.frames];for(var ay=0;ay<aw.frames.length;ay++){p(aw.frames[ay],az);}}if(aw.defaults){for(var ax in aw.defaults){if(av.hasOwnProperty(ax)&&aw.defaults.hasOwnProperty(ax)){av[ax]=aw.defaults[ax];}}}}w=true;}var ah={init:function(){if(lpTag&&lpTag.taglets&&lpTag.taglets.lpAjax){try{lpTag.taglets.lpAjax.addTransport(U,ah);}catch(aw){}}},issueCall:m,isValidRequest:A,getVersion:function(){return z;},getName:function(){return U;},configure:V,getFrameData:ac,inspect:function(){return{name:U,version:z,callsMade:H,errorsFound:o,pending:u,defaults:av,iFrameList:aa(R),activeFrames:ak()};}};if(lpTag&&lpTag.taglets&&lpTag.taglets.lpAjax){try{lpTag.taglets.lpAjax.addTransport(U,ah);}catch(af){}}return ah;})(window);window.lpTag=window.lpTag||{};lpTag.taglets=lpTag.taglets||{};lpTag.taglets.jsonp=lpTag.taglets.jsonp||(function(F){var y={callback:"cb",encoding:"UTF-8",timeout:10000,retries:2};var q={ERROR:"ERROR",DEBUG:"DEBUG",INFO:"INFO"};var d=true;var e=false;var l=2083;var j="lpCb";var N={};var n=0;var f=0;var r=0;var P=0;var w=0;var L;var z={};var g=D().length;var K="1.0.7";var M="jsonp";function c(R){if(typeof R==="string"){var Q=R;R={url:Q};}if(!R.url){return false;}R.encoding=R.encoding||y.encoding;R.callback=R.callback||y.callback;R.retries=typeof R.retries==="number"?R.retries:y.retries;R.timeout=R.timeout?R.timeout:y.timeout;return R;}function D(){return Math.round(Math.random()*99999)+"x"+Math.round(Math.random()*99999);}function t(){return"scr"+Math.round(Math.random()*999999999)+"_"+Math.round(Math.random()*999999999);}function J(S){var Q=false;if(d&&S&&S.url){var R=g,U=false;if(S.callbackName&&typeof S.callbackName==="string"){R=S.callbackName.length;if(z[S.callbackName]||F[S.callbackName]){U=true;}}var T=2+(S.callback||y.callback).length+S.url.length+R+H(S.data).length;if(T<l&&!U){Q=true;}}return Q;}function H(S){var U="";if(typeof S==="string"){U+=S;}else{var T=true;for(var Q in S){var R;if(typeof S[Q]=="object"){R=JSON.stringify(S[Q]);}else{if(typeof S[Q]!=="function"){R=S[Q];}}if(R){if(!T){U+="&";}U+=encodeURIComponent(Q)+"="+encodeURIComponent(R);T=false;}}}return U;}function A(R){var Q;if(J(R)){R=c(R);if(!R.callbackName||typeof R.callbackName!=="string"){R.callbackName=j+D();}else{R.retries=0;}Q=R.url+(R.url.indexOf("?")>-1?"&":"?")+R.callback+"="+R.callbackName+"&"+H(R.data);R.callUrl=Q;if(p(R)){k(R);v();}else{i("URL request was too long and was not sent, url: "+Q,q.ERROR,"issueCall");}}else{i("URL request was too long or static callback name already exists, url: "+Q,q.ERROR,"issueCall");a();if(R&&R.error){b(q.ERROR,R.error,{responseCode:600,error:"Transport - JSONP - unable to run request: "+R.url,body:"ERROR"},R.context);}return false;}return true;}function p(R){var Q=false;var U=new RegExp(/(http{1}s{0,1}?:\/\/)([^\/\?]+)(\/?)/ig);var T;if(R.callUrl.indexOf("http")===0){T=U.exec(R.callUrl);}else{T=U.exec(F.location.href);}if(T&&T.length>=3&&T[2]!==""){var S=T[2].toLowerCase();R.domainMatch=S;N[S]=N[S]||[];N[S].inFlight=N[S].inFlight||0;N[S].push(R);Q=true;f=f+1;i("buffered URL: "+R.callUrl,q.DEBUG,"lpTag.taglets.jsonp.bufferRequest");}else{i("NO MATCH for URL: "+R.callUrl,q.ERROR,"lpTag.taglets.jsonp.bufferRequest");}return Q;}function v(){var T;for(var Q in N){if(N.hasOwnProperty(Q)){T=N[Q];var S=false;while(!S&&T.inFlight<6&&T.length>0){var R=T.shift();if(R){i("Sent URL: "+R.callUrl,q.DEBUG,"lpTag.taglets.jsonp.sendRequests");R.scriptId=G(R.callUrl,R.encoding,R.callbackName);C(Q,R.callbackName,R.timeout);f=f-1;}else{S=true;}}}}T=null;}function B(){clearTimeout(L);L=null;var Q=new Date();for(var R in z){if(z.hasOwnProperty(R)&&z[R].launchTime){var S=Q-z[R].launchTime;if(z[R].loadTime||S>z[R].timeout){F[R].apply(null,[{responseCode:404,error:{message:"Request timed out",id:404,name:"timeout"}},true]);}}}if(r>0){L=setTimeout(B,1000);}}function G(Q,R,S){var U=t();var T=document.createElement("script");T.setAttribute("type","text/javascript");T.setAttribute("charset",R);T.onload=function(){if(z[S]){z[S].loadTime=new Date();}this.onload=this.onerror=this.onreadystatechange=null;};if(!F.addEventListener){T.onreadystatechange=function(){if(this.readyState){if(this.readyState==="loaded"||this.readyState==="complete"){if(z[S]){z[S].loadTime=new Date();}this.onload=this.onerror=this.onreadystatechange=null;}}};}else{T.onerror=function(){if(z[S]){z[S].loadTime=new Date();}this.onload=this.onerror=this.onreadystatechange=null;};}T.setAttribute("src",Q);T.setAttribute("id",U);document.getElementsByTagName("head")[0].appendChild(T);if(!L){L=setTimeout(B,1000);}T=null;return U;}function C(Q,S,R){N[Q].inFlight=N[Q].inFlight+1;z[S]={launchTime:new Date(),timeout:R};r=r+1;n=n+1;}function a(){P=P+1;}function u(T){var S;while(S=document.getElementById(T)){try{S.parentNode.removeChild(S);for(var R in S){if(S.hasOwnProperty(R)){delete S[R];}}}catch(Q){i("error when removing script",q.ERROR,"removeScript");}}}function E(Q){N[Q].inFlight=N[Q].inFlight-1;r=r-1;}function x(S,R,Q){u(R.scriptId);E(R.domainMatch);O(R.callbackName,Q);if(Q){if(R.callbackName){R.callbackName=null;delete R.callbackName;}I(S,R);}else{m(R);b("callback",R.success,S,R.context);R=null;v();}}function I(R,Q){w=w+1;if(Q.retries>0){Q.retries=Q.retries-1;A(Q);}else{m(Q);b(q.ERROR,Q.error,R||{responseCode:404,error:{id:404,name:"timeout",message:"Request has timed out on all retries"}},Q.context);Q=null;v();}}function m(S){var R=["callUrl","retries","id","requestTimeout","type","encoding","launchTime","callbackName","domainMatch"];for(var Q=0;Q<R.length;Q++){if(S.hasOwnProperty(R[Q])){S[R[Q]]=null;delete S[R[Q]];}}}function b(R,U,S,Q){if(typeof U==="function"){try{U.call(Q||null,S);U=null;}catch(T){i("Exception in execution of callback, type :"+R+" e=["+T.message+"]",q.ERROR,"runCallback");}}else{i("No callback, of type :"+R,q.INFO,"runCallback");}}function O(S,Q){z[S]=null;delete z[S];if(Q===true){F[S]=function(){F[S]=null;try{delete F[S];}catch(T){}};}else{F[S]=null;try{delete F[S];}catch(R){}}}function k(Q){if(z[Q.callbackName]){a();I({responseCode:600,error:{message:"This callbackName is already in a pending request and can't be serviced",id:600,name:"timeout"}},Q);}else{F[Q.callbackName]=function(S,R){x(S,Q,R);};}}function i(S,R,Q){if(e===true||R===q.ERROR){if(F.lpTag&&lpTag.log){lpTag.log(S,R,Q);}}}function s(Q){if(Q){for(var R in Q){if(y.hasOwnProperty(R)&&Q.hasOwnProperty(R)){y[R]=Q[R];}}e=typeof Q.debugMode==="boolean"?Q.debugMode:e;}}var o={init:function(){if(lpTag&&lpTag.taglets&&lpTag.taglets.lpAjax){try{lpTag.taglets.lpAjax.addTransport(M,o);}catch(Q){}}},configure:s,issueCall:A,isValidRequest:J,getVersion:function(){return K;},getName:function(){return M;},inspect:function(){return{name:M,version:K,callsMade:n,errorsFound:w,pending:r,buffered:f,refused:P,defaults:(function(){var R={};for(var Q in y){if(y.hasOwnProperty(Q)){R[Q]=y[Q];}}return R;})()};}};if(lpTag&&lpTag.taglets&&lpTag.taglets.lpAjax){try{lpTag.taglets.lpAjax.addTransport(M,o);}catch(h){}}return o;})(window);window.lpTag=window.lpTag||{};lpTag.taglets=lpTag.taglets||{};lpTag.taglets.xhr=lpTag.taglets.xhr||(function lpXHR(L){var I={JSON:"application/json",JAVASCRIPT:"text/javascript",HTML:"text/html",XMLAPP:"application/xml",XMLTEXT:"text/xml",FORM:"application/x-www-form-urlencoded;"};var x={GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE"};var B={PROGRESS:"progress",LOAD:"load",ERROR:"error",ABORT:"abort",READYSTATE:"readystatechange"};var w={ERROR:"ERROR",DEBUG:"DEBUG",INFO:"INFO"};var G={encoding:"UTF-8",method:x.GET,asynch:true,timeout:30000,mimeType:I.JSON,cache:false,acceptHeader:"*/*",XMLHTTPOverride:true,retries:2};var m={UNSENT:0,OPENED:1,HEADERS_RECIEVED:2,LOADING:3,COMPLETE:4};var aa="xhr";var Z="1.0.2";var k=o(document.location.href);var g="X-HTTP-Method-Override";var T={responseCode:404,HTTPStatus:"bad request",body:{error:"Request timed out"},headers:""};var F={responseCode:600,HTTPStatus:"unable to service request",body:{error:"Transport - "+aa+" - unable to run request"},headers:""};var p=!L.addEventListener;var J=2083;var s=0,f=0;var y=[];var P=[];var Y;var c=true;function A(ae){if(ae&&ae.defaults){for(var ad in ae.defaults){if(ae.defaults.hasOwnProperty(ad)&&G.hasOwnProperty(ad)){G[ad]=ae.defaults[ad];}}}c=true;}function b(ad){ad.method=ad.method||G.method;ad.encoding=ad.encoding||G.encoding;ad.mimeType=ad.mimeType||G.mimeType;ad.retries=!isNaN(ad.retries)?ad.retries:G.retries;ad.timeout=ad.timeout||G.timeout;ad.XMLHTTPOverride=typeof ad.XMLHTTPOverride=="boolean"?ad.XMLHTTPOverride:G.XMLHTTPOverride;ad.cache=typeof ad.cache==="boolean"?ad.cache:G.cache;ad.asynch=typeof ad.asynch==="boolean"?ad.asynch:G.asynch;if((ad.method.toLowerCase()===x.PUT.toLocaleLowerCase()||ad.method.toLowerCase()===x.DELETE.toLocaleLowerCase())&&ad.XMLHTTPOverride){ad.headers[g]=ad.method;ad.method=x.POST;}return ad;}function u(ae){var ad=ae.url.indexOf("__d=");if(ad>-1){ae.url=ae.url.substr(0,ad-1);}if(!ae.cache&&(ae.method.toLowerCase()!==x.GET.toLowerCase()||ae.url.length<=(J-10))){ae.url+=ae.url.indexOf("?")>0?"&__d=":"?__d=";ae.url+=Math.floor(Math.random()*100000);}}function V(af){af=b(af);var ae=false;if(af&&af.url&&typeof af.url==="string"){if(k==o(af.url)){if(af.method.toLowerCase()===x.GET.toLowerCase()){var ad=J,ag="";if(af.url.indexOf("http")!==0){af.url=K(af.url);}if(af.data){ag=Q(af.data);}if(!af.cache){ad=ad-10;}if((af.url.length+1+ag.length)<=ad){ae=true;}}else{ae=true;}}}return(c&&ae);}function K(af){var ae=document.location.href.lastIndexOf("/")||document.location.href.lastIndexOf("?");var ad=document.location.href.substr(0,ae);af=ad+"/"+af;return af;}function o(ad){var ag=new RegExp(/(http{1}s{0,1}?:\/\/)([^\/\?]+)(\/?)/ig);var af,ae=null;if(ad.indexOf("http")===0){af=ag.exec(ad);}else{af=ag.exec(L.location.href);}if(af&&af.length>=3&&af[2]!==""){ae=af[1].toLowerCase()+af[2].toLowerCase();}return ae;}function q(ah,ag,ae){ag=ag||{};ag["Content-Type"]=z(ag["Content-Type"]||G.mimeType,ae.encoding);ag.Accept=ag.Accept||G.acceptHeader;ag["X-Requested-With"]="XMLHttpRequest";if(ag){for(var ad in ag){if(ag.hasOwnProperty(ad)){try{ah.setRequestHeader(ad,ag[ad]);}catch(af){}}}}return ah;}function z(ae,af){var ad=ae;if(!ad||ad==""||ad.indexOf("charset")<0){ad=(ad||G.MIMETYPE)+"; charset="+(af||G.encoding);}return ad;}function H(ad){if(V(ad)){C(ad);}else{if(ad&&ad.error){j(ad.error,F,ad.context);}}}function D(af){var ag=p?O(af):E(af);if(ag.overrideMimeType){ag.overrideMimeType(af.mimeType);}if(af.method===x.GET&&af.data){var ae=Q(af.data);if(ae){af.url+=af.url.indexOf("?")<0?"?":"&";af.url+=ae;}af.data=null;}u(af);try{if(typeof af.data!=="undefined"){af.data=l(af.data);}}catch(ad){j(af.error,{responseCode:601,HTTPStatus:"Unable to service request",headers:"",body:{error:"unable to stringify data for requests"}},af.context);U(ag);return false;}af.xhr=ag;ag.open(af.method,af.url,af.asynch);ag=q(ag,af.headers,af);N(af);ag.send(af.data||null);if(!Y){setTimeout(S,1000);}return true;}function N(ad){ad.launchTime=new Date();P.push(ad);M();}function C(ad){y.push(ad);R();}function S(){if(Y){clearTimeout(Y);Y=null;}var ae=new Date();var ai=[];for(var af=0;af<P.length;af++){var ah=P[af];var ag=ae.valueOf()-ah.launchTime.valueOf();if(ag>ah.timeout){ab(ah,ah.xhr,true);ai.push(ah);}}for(var ad=0;ad<ai.length;ad++){W(ai[ad]);ai[ad]=null;}if(y.length>0||P.length>0){Y=setTimeout(S,1000);}}function ab(ag,ah,af,ae){X();if(!af){W(ag);}e(ag);if(af&&ah){try{ah.abort();}catch(ad){i("Error when trying to abort request "+ag.url,w.ERROR);}}if(ah){U(ah);}if(ag.retries>0&&!ae){ag.retries=ag.retries-1;C(ag);}else{j(ag.error,ae||T,ag.context);}}function Q(af){var ah="";if(typeof af==="string"){ah+=af;}else{var ag=true;for(var ad in af){var ae;if(typeof af[ad]=="object"){ae=encodeURIComponent(JSON.stringify(af[ad]));}else{if(typeof af[ad]!=="function"){ae=encodeURIComponent(af[ad]);}}if(ae){if(!ag){ah+="&";}ah+=encodeURIComponent(ad)+"="+encodeURIComponent(ae);ag=false;}}}return ah;}function e(af){var ae=["xhr"];for(var ad=0;ad<ae.length;ad++){af[ae[ad]]=null;delete af[ae[ad]];}}function l(ad){if(typeof ad==="object"){return JSON.stringify(ad);}else{if(typeof ad==="string"){return ad;}else{return"";}}}function R(){while(P.length<6&&y.length>0){D(y.shift());}}function j(ag,ae,ad){if(ag&&typeof ag=="function"){try{ag.call(ad,ae);}catch(af){i(af.message);}}}function i(ae,ad){if(L.lpTag&&lpTag.log){lpTag.log(ae,ad,name);}}function E(ad){var ae=new L.XMLHttpRequest();ae.addEventListener(B.LOAD,function(){if(ad&&!ad.completed){n(this,ad);ad.completed=true;}else{ad=null;}});ae.addEventListener(B.PROGRESS,function(){var af=v(this);if(af&&ad.progress){j(ad.progress,af,ad.context);}});ae.addEventListener(B.ERROR,function(){if(ad&&!ad.completed){h(this,ad);ad.completed=true;}else{ad=null;}});ae.addEventListener(B.READYSTATE,function(){if(this.readyState===m.COMPLETE){if(ad&&!ad.completed){n(this,ad);ad.completed=true;}else{ad=null;}}});return ae;}function O(ad){var ae=new L.XMLHttpRequest();ae[B.READYSTATE]=function(){if(!ad.completed){if(this.readyState===m.COMPLETE){n(this,ad);ad.completed=true;}}};ae[B.ERROR]=function(){h(this,ad);};return ae;}function U(ad){ad[B.READYSTATE]=null;ad[B.ERROR]=null;if(!p){ad[B.PROGRESS]=null;ad[B.LOAD]=null;}ad=null;}function v(ag){var ae,ad;if(ag){try{ad=ac(ag);ae={responseCode:r(ag,"status")||404,HTTPStatus:r(ag,"statusText"),body:r(ag,"responseText","string")||r(ag,"responseXML"),headers:ad.headers,originalHeader:ad.originalHeader};}catch(af){i(af.message,w.ERROR);return{};}}else{i("No data from request",w.INFO);return{};}if(ae&&ae.headers&&ae.headers["Content-Type"]&&ae.headers["Content-Type"]===I.JSON){try{ae.body=JSON.parse(ae.body);}catch(af){}}ae.responseCode=ae.responseCode==1223?204:ae.responseCode;if(ae.responseCode>=12000){ae.internalCode=ae.responseCode;ae.responseCode=500;}return ae;}function r(ag,ad,ae){try{if(ae){if(typeof ag[ad]===ae){return ag[ad];}else{return"";}}else{return ag[ad];}}catch(af){return"";}}function ac(ak){var ah,ag={};try{ah=ak.getAllResponseHeaders();}catch(ai){ah="";}if(ah){var af=ah.split("\n");for(var ae=0;ae<af.length;ae++){try{var ad=af[ae].split(":");if(ad[0]){var aj=ad.length>2?ad.slice(1).join(":"):ad[1];ag[a(ad[0])]=a(aj);}}catch(ai){}}}return{originalHeader:ah,headers:ag};}function a(ad){if(ad&&typeof ad==="string"){ad=ad.replace(/^[\s\r]*/,"");ad=ad.replace(/[\s\r]*$/g,"");}return ad;}function n(ag,af){e(af);var ae=v(ag);if(ae){var ad;if(ae.responseCode>399){ab(af,ag,false,ae);}else{W(af);ad=af.success;j(ad,ae,af.context);U(ag);}}R();}function h(ae,ad){ab(ad,ae);R();}function X(){f=f+1;}function M(){s=s+1;}function W(ae){for(var ad=0;ad<P.length;ad++){if(P[ad]===ae){P.splice(ad);break;}}}if(p){B.READYSTATE="on"+B.READYSTATE;B.ERROR="on"+B.ERROR;}var t={init:function(){if(lpTag&&lpTag.taglets&&lpTag.taglets.lpAjax){try{lpTag.taglets.lpAjax.addTransport(aa,t);}catch(ad){}}},configure:A,issueCall:H,isValidRequest:V,getVersion:function(){return Z;},getName:function(){return aa;},inspect:function(){return{name:aa,version:Z,callsMade:s,errorsFound:f,pending:P.length,defaults:(function(){var ae={};for(var ad in G){if(G.hasOwnProperty(ad)){ae[ad]=G[ad];}}return ae;})()};}};if(lpTag&&lpTag.taglets&&lpTag.taglets.lpAjax){try{lpTag.taglets.lpAjax.addTransport(aa,t);}catch(d){}}return t;})(window);window.lpTag=window.lpTag||{};lpTag.taglets=lpTag.taglets||{};lpTag.taglets.rest2jsonp=lpTag.taglets.rest2jsonp||(function(){var R="1.1";var D="1";var S="rest2jsonp";var o=0,i=0,h=0;var B={retries:3,method:"GET",timeout:30000,encoding:"UTF-8",callback:"cb"};var r={prefix:"https://",middle:"/api/account/",suffix:"/js2rest"};var f="";var F={site:"",domain:""};var k="1";var n=32;var N={PART_PARAM:"lpP",OUTOF_PARAM:"lpO",SECURE_IDENTIFIER:"lpS"};var j={VERSION_PARAM:"lpV",BODY_PARAM:"lpB",JSON:"lpjson",CALLID:"lpCallId"};var T=G().length;var E=2083;var d=z();var J=v();var m={};function y(W){for(var V in B){if(B.hasOwnProperty(V)){W[V]=W[V]||B[V];}}W.data=x(W);W.url=f+a(W.data.u);return W;}function x(V){return{u:K(V.url),m:V.method||B.method,b:V.data||"",h:V.headers||""};}function K(V){if(V&&V.indexOf(".json?")){V=V.replace(".json?","?");}return V;}function O(V){if(V&&typeof V.url==="string"&&typeof V.success==="function"&&F.site&&F.domain&&f){return true;}else{return false;}}function l(X,V,W){if(lpTag&&lpTag.log){lpTag.log(X,V,W);}}function G(){return Math.round(Math.random()*9999999999)+"-"+Math.round(Math.random()*9999999999);}function A(V){return V?encodeURIComponent(JSON.stringify(V)):"";}function z(){var W=0;for(var V in j){if(j.hasOwnProperty(V)){W+=("&"+j[V]+"=99").length;}}W+=R.length+B.callback.length+k.length+T;return W;}function v(){var W=0;for(var V in N){if(N.hasOwnProperty(V)){W+=("&"+N[V]+"=99").length;}}W+=3;W+=n;return W;}function q(Y,W){var V=Y.url+(Y.url.indexOf("?")>-1?"&":"?")+j.VERSION_PARAM+"="+D+"&"+j.JSON+"="+k;if(W){var X=A(Y.data);if(X){V+="&"+j.BODY_PARAM+"="+X;}}return V;}function L(V){return(V.url.length+d+A(V.data).length>E);}function c(W,Z,X,V){if(typeof Z==="function"){try{Z.call(V||null,X);}catch(Y){l("Exception in execution of callback, type :"+W+" e=["+Y.message+"]","ERROR","lpTag.JSONP.runCallback");}}else{l("No callback, of type :"+W,"INFO","lpTag.JSONP.runCallback");}}function I(X,V){var W={};W.encoding=X.encoding;W.timeout=X.timeout||B.timeout;W.callback=X.callback||B.callback;W.retries=typeof V==="number"?V:0;return W;}function g(V){V.id=G();m[V.id]={originalRequest:V,index:0,baseUrl:q(V,false),urls:Q(V.url,A(V.data),V.id),interimObj:I(V)};t(m[V.id].interimObj,m[V.id]);}function t(W,V){W.url=H(V);W.id=V.id+"!"+V.index;W.success=function(X){if(X&&(X.responseCode===200||X.responseCode===201)){if(X&&X.lpMeta&&X.lpMeta.lpS){V.secureId=X.lpMeta.lpS;}if((V.index+1)<V.urls.length){V.index++;t(W,V);}else{V.originalRequest.success.apply(null,[X]);w(V.id);}}else{V.originalRequest.error.apply(null,[X]);w(V.id);P();}b();};W.error=W.success;lpTag.taglets.jsonp.issueCall(W);M();}function U(W){var V=I(W,W.retries||B.retries);V.id=G();V.url=q(W,true);V.success=function(X){if(X.responseCode&&X.responseCode===200||X.responseCode===201){c("CALLBACK",W.success,X,W.context);}else{c("ERROR",W.error,X,W.context);P();}V=null;W=null;b();};V.error=function(X){c("ERROR",W.error,X,W.context);V=null;W=null;b();P();};lpTag.taglets.jsonp.issueCall(V);M();}function w(V){m[V]=null;delete m[V];}function H(V){return V.baseUrl+"&"+N.PART_PARAM+"="+(V.index+1)+"&"+N.OUTOF_PARAM+"="+V.urls.length+(V.secureId?"&"+N.SECURE_IDENTIFIER+"="+V.secureId:"")+"&"+j.BODY_PARAM+"="+V.urls[V.index];}function Q(V,W,Y){V+="&"+j.CALLID+"="+Y;var X=E-V.length-J-d;return s(X,W);}function s(V,X){var Z="",ad=[],Y;var W=X.split("%");for(Y=0;Y<W.length;Y++){if(W[Y].length>V){W[Y]=aa(Z,W[Y],ad,Y,V);Z="";Z=ab(W[Y],V,ad);}else{Z=ac(Z,W[Y],V,ad,Y);}}if(Z!==""){ad.push(Z);}function aa(ah,aj,af,ag,ae){ah+=ag>0?"%":"";var ai=ae-ah.length;ah+=aj.substring(0,ai);af.push(ah);aj=aj.substring(ai,aj.length);return aj;}function ab(aj,ae,ag){var ai=Math.ceil(aj.length/ae);for(var ah=0;ah<ai;ah++){var af=aj.substring(ah*ae,(ah+1)*ae);if(ah+1<ai){ag.push(af);}}return af;}function ac(ai,aj,ae,af,ag){var ah=(ai+aj).length;ah+=(ag>0)?1:0;if(ah>ae){af.push(ai);ai="";}ai+=ag>0?"%":"";ai+=aj;return ai;}return ad;}function M(){o=o+1;h=h+1;}function b(){h=h>0?h-1:0;}function P(){i=i+1;}function C(V){if(O(V)){V=y(V);if(L(V)){return g(V);}else{return U(V);}}else{return false;}}function a(V){var W="";if(V.indexOf("/agentSession")!=-1){W="/agentSession";}else{if(V.indexOf("/chat")!=-1){W="/chat";}else{if(V.indexOf("/visit")!=-1){W="/visit";if(V.indexOf("/keepAlive")!=-1){W+="/keepAlive";}}else{if(V.indexOf("/configuration")!=-1){W="/configuration";}}}}return W;}function u(W){for(var V in W){if(W.hasOwnProperty(V)){if(B.hasOwnProperty(V)){B[V]=W[V];}else{if(F.hasOwnProperty(V)){F[V]=W[V];}}}}if(F.domain&&F.site){f=r.prefix+F.domain+r.middle+F.site+r.suffix;}}var p={init:function(){if(lpTag&&lpTag.taglets&&lpTag.taglets.lpAjax){try{lpTag.taglets.lpAjax.addTransport(S,p);}catch(V){}}},configure:u,issueCall:C,isValidRequest:O,getVersion:function(){return R;},getName:function(){return S;},inspect:function(){return{name:S,version:R,callsMade:o,errorsFound:i,pending:h,baseUrl:f,defaults:(function(){var W={};for(var V in B){if(B.hasOwnProperty(V)){W[V]=B[V];}}return W;})()};}};if(lpTag&&lpTag.taglets&&lpTag.taglets.lpAjax){try{lpTag.taglets.lpAjax.addTransport(S,p);}catch(e){}}return p;})();(function(b){b.lpTag=b.lpTag||{};lpTag.taglets=lpTag.taglets||{};lpTag.utils=lpTag.utils||{};function a(e,d,c){if(lpTag&&lpTag.utils&&lpTag.utils.log){lpTag.utils.log(e,d,c);}}lpTag.utils.runErrorCallback=function(d,c){if(d&&d.error){lpTag.utils.runCallback(d.error,d,c);}c=null;d=null;};lpTag.utils.runSuccessCallback=function(d,c){if(d&&d.success){lpTag.utils.runCallback(d.success,d,c);}};lpTag.utils.runCallback=function(f,e,d){if(f&&typeof f==="function"){try{f.call(e.context||e,d);}catch(c){a("Failed to run callback, callback: "+f+" data: "+d,"error","lpTag.utils.runCallback");}}};lpTag.utils.trim=function(c){if(typeof c==="string"&&c!==""){c=c.replace(/^[\s*\n*\r*\t\*]*$[\s*\n*\r*\t\*]*/g,"");}return c;};lpTag.utils.getErrorData=function(f,e,d,g){f=f&&f.body?f.body:{error:{message:e,time:new Date(),originalRequest:d}};for(var c in g){if(g.hasOwnProperty(c)&&!f[c]){f[c]=g[c];}}g=null;return f;};lpTag.utils.getResponseData=function(g,l,c,k){var j=g&&g.body?g.body:g;j=j||{};var d,h,n;if(l){n=l.split(".");h=n.length;for(var f=0;f<h;f++){d=n[f];if(typeof j[d]!=="undefined"){j=j[d];}else{break;}}if(c===true){var e={};e[n[h-1]]=j;j=e;}}j=lpTag.utils.removeRels(j);for(var m in k){if(k.hasOwnProperty(m)&&typeof j[m]==="undefined"){j[m]=k[m];}}return j;};lpTag.utils.removeRels=function(d){for(var c in d){if(d.hasOwnProperty(c)){if(c=="link"){d[c]=null;delete d[c];}else{if(typeof d[c]==="object"){d[c]=lpTag.utils.removeRels(d[c]);}}}}return d;};lpTag.utils.deleteProps=function(f,e){for(var d=0;d<e.length;d++){if(f.hasOwnProperty(e[d])){try{f[e[d]]=null;delete f[e[d]];}catch(c){}}}};})(window);window.lpTag=window.lpTag||{};lpTag.taglets=lpTag.taglets||{};lpTag.utils=lpTag.utils||{};lpTag.utils.log=lpTag.utils.log||function(){};lpTag.utils.log.debug=false;lpTag.taglets.ChatOverRestAPI=lpTag.taglets.ChatOverRestAPI||function ChatOverRestAPI(ae){if(this===window){return false;}var K=this;var W={},ad=0,L=(ae&&ae.failureTolerance)||9;var d={};var f;var O;var V;var u=false;var c=false,g=false,G=0,ac="1.1.0";var o={resumeMode:"lpVisitorResumeMode",sessionVars:"lpVisitorSessionVars",chat:"lpVisitorChatRels",sessionUID:"lpSessionUID"};var ai="::";var F={QA:"QA",DEV:"DEV",PRODUCTION:"PRODUCTION",CI:"CI",CLOUD:"CLOUD"};var S=F.PRODUCTION;var af=function(){return(S!=F.PRODUCTION)?"/hcp/html/lpsunco/postmessage.html":"/hcp/html/postmessage.min.html";};var s={ERROR:"ERROR",INFO:"INFO"};var E=false;var ah=lpTag.utils;var h;var l=lpTag&&lpTag.taglets&&lpTag.taglets.jsonp;var A=lpTag&&lpTag.taglets&&lpTag.taglets.lpAjax;var aa={typing:false,visitorName:"",agentName:"",rtSessionId:"",initialised:false,agentTyping:false,chatInProgress:false,visitorId:"",agentId:"",timeout:"",chatSessionKey:"",chatState:"",exitSurveyOn:false};function v(aj){if(lpTag.utils.Events&&lpTag.RelManager&&lpTag.SessionDataManager){f=lpTag.utils.Events({cloneEventData:true,eventBufferLimit:50});O=new Q();V=new lpTag.RelManager(aj&&aj.transportOrder);h=new window.lpTag.utils.SessionDataAsyncWrapper(ae);B();}else{if(G<20){setTimeout(v,500);}else{}}G++;}function P(){return !!(d.lpNumber&&d.appKey&&d.domain);}function b(aj,ak){if(aj){if(aj.clearDomain){d.domain=ah.trim(aj.domain);}else{d.domain=ah.trim(aj.domain)||ah.trim(d.domain)||"";}d.lpNumber=ah.trim(aj.lpNumber)||ah.trim(d.lpNumber)||"";d.appKey=ah.trim(aj.appKey)||ah.trim(d.appKey)||"";if(ae.sessionUID){d.sessionUID=ae.sessionUID;}if(d.lpNumber&&d.appKey&&d.domain){V.setData(d);if((typeof ak!=="booelan"||ak)&&!h.usingSecureStorage){h.setSessionData(M(o.sessionVars),d,function(){},function(){},null,false);}}S=aj&&aj.environment&&F[aj.environment]?aj.environment:S;if(d.domain&&d.lpNumber){z();}}}function B(){K.onInit(function(al){if(!al.error){aa.initialised=true;}});K.onStart(function(al){if(!al.error){aa.chatInProgress=true;}});K.onState(function(al){if(!al.error){aa.state=al.state;switch(aa.state){case K.chatStates.CHATTING:case K.chatStates.WAITING:case K.chatStates.RESUMING:if(aa.state!==K.chatStates.RESUMING&&!h.usingSecureStorage){h.setSessionData(M(o.resumeMode),true,null,null,null,false);}aa.chatInProgress=true;O.changeKeepAliveState();break;case K.chatStates.INITIALISED:aa.chatInProgress=g?true:false;break;case K.chatStates.ENDED:case K.chatStates.UNINITIALISED:aa.chatInProgress=false;O.changeKeepAliveState();break;case K.chatStates.NOTFOUND:aa.chatInProgress=false;aa.exitSurveyOn=false;O.changeKeepAliveState();break;default:break;}}});K.onVisitorName(function(al){if(!al.error){aa.visitorName=al.visitorName;}});K.onSetVisitorTyping(function(al){if(!al.error){aa.typing=al.typing;}});W=ak(ae);b(W,false);aj(W);if(typeof W.debug==="boolean"){K.setDebugMode(W.debug);}if((document.readyState=="interactive"||document.readyState=="complete")&&document.body){y();}else{if(window.addEventListener){document.addEventListener("DOMContentLoaded",y,false);}else{document.attachEvent("onreadystatechange",function(){if((document.readyState=="interactive"||document.readyState=="complete")&&!u&&document.body){y();}});}}function aj(an){for(var am in an){if(an.hasOwnProperty(am)){if(String(am).indexOf("on")==0){if(K.hasOwnProperty(am)){an[am]=an[am].constructor===Array?an[am]:[an[am]];for(var al=0;al<an[am].length;al++){if(typeof an[am][al]==="function"){K[am](an[am][al]);}else{if(typeof an[am][al]==="object"&&an[am][al].callback){if(typeof an[am][al].callback==="function"){K[am](an[am][al].callback,(an[am][al].appName||""),(an[am][al].context||null));}}}}}}}}}function ak(ao){if(ao){var ap={};for(var am in ao){if(ao.hasOwnProperty(am)){var an=typeof(ap[am])!=="undefined";var al=am.indexOf("on")==0;if(!an){ap[am]=ao[am];}else{if(ap[am]!==ao[am]&&!al){ap[am]=ao[am];}else{ap[am]=ap[am].constructor===Array?ap[am]:[ap[am]];ap[am].push(ao[am]);}}}}}return ap;}}function y(){u=true;if(!ae.doNotResume||S===F.PRODUCTION){if(ae.sessionUID){h.getSessionData(M(ae.sessionUID),U,U,null);}else{if(h){h.getSessionData(M(o.resumeMode),I,I,null);}}}else{if(P()){Y();f.publish({eventName:"onLoad",data:{API:"Chat API SDK Loaded",version:ac,state:(g?K.chatStates.RESUMING:K.chatStates.UNINITIALISED)}});aa.chatInProgress=false;}}}function j(ak,an,aj,al){if(!f){return false;}var am={eventName:ak,appName:aj||"",aSync:false,func:an,context:(al||null)};return f.register(am);}function N(ak,aj,an,al){if(!f){return false;}if(typeof ak==="function"){an=ak;ak="";}else{if(typeof ak==="object"){al=ak;ak="";}}var am={eventName:ak,appName:aj||"",func:an,context:(al||null)};return f.unbind(am);}function M(al){if(!ae.lpNumber){return"";}if(typeof al==="object"){var ak=[];for(var aj in al){if(al.hasOwnProperty(aj)){ak.push(al[aj]+ae.lpNumber);}}return ak;}else{return al+ae.lpNumber;}}function Q(){var aq,ao,aj;var an={inChat:2000,exitSurvey:15000};var am=an.inChat;var al=this;function ak(){if(aq){clearTimeout(aq);aq=null;}}function ar(){a({success:ap,error:ap});ao=new Date().valueOf();}function ap(){if(aj){ak();var at=(new Date().valueOf())-ao;at=am-at;if(at>0){aq=setTimeout(ar,at);}else{ar();}}}al.changeKeepAliveState=function(){ak();aj=(aa.chatInProgress||aa.exitSurveyOn);if(aj){if(aa.chatInProgress){am=an.inChat;}else{am=an.exitSurvey;}ar();}};al.storeChatLocationURI=function(av,ax){var au=M(o.chat);if(ae.sessionUID){au=M(ae.sessionUID);}var at={chatRel:av,location:window.location.href};if(ax){at.overRides={};for(var aw in ax){if(ax.hasOwnProperty(aw)){at.overRides[aw]=ax[aw];}}}h.setSessionData(au,at,function(){},function(){},null);};al.sessionEnded=function(){h.removeSessionData(M(o.sessionVars),function(){},function(){},null);h.removeSessionData(M(o.chat),function(){},function(){},null);h.removeSessionData(M(o.resumeMode),function(){},function(){},null);if(ae.sessionUID){h.removeSessionData(M(ae.sessionUID),function(){},function(){},null);}};}function ab(al,ak,am,aj){e(s.ERROR,{error:al,originalRequest:ak,sentRequest:am,response:aj});ak=null;am=null;aj=null;return al;}function e(ak,al){var aj={eventName:"onLog"};if(ak&&typeof ak==="string"){aj.appName=ak;}else{if(typeof ak==="object"){al=ak;}}aj.data=al;if(aj.appName&&aj.appName!==s.ERROR&&!c){aj=null;return;}f.publish(aj);aj=null;}K.setDebugMode=function(aj){if(typeof aj==="boolean"){c=aj;lpTag.utils.log.debug=aj;}};function z(){A.configureTransports({rest2jsonp:{domain:d.domain,site:d.lpNumber},postmessage:{frames:[{url:"https://"+d.domain+af(),delayLoad:0}]}});}function I(aj){if(aj===true||aj==="true"){h.getSessionData(M(o.sessionVars),k,k,null);}else{C();}}function C(){aa.chatInProgress=false;g=false;f.publish({eventName:"onLoad",data:{API:"Chat API SDK Loaded",version:ac,state:(g?K.chatStates.RESUMING:K.chatStates.UNINITIALISED)}});Y();}function k(aj){if(aj&&typeof aj==="object"&&!aj.error){if(R(ae,aj)){b(aj);g=true;h.getSessionData(M(o.chat),U,U,null);}}else{C();}}function U(aj){if(!aj||(aj&&(!aj.chatRel&&!aj.otk))){C();}else{if(typeof aj==="object"&&aj.otk){aa.chatInProgress=true;f.publish({eventName:"onLoad",data:{API:"Chat API SDK Loaded",version:ac,state:(g?K.chatStates.RESUMING:K.chatStates.UNINITIALISED)}});if(aj.overRides){b(aj.overRides);}Y({withOtk:true,success:function(){H(p(K.chatStates.RESUMING,new Date()));q({otk:aj.otk},aj.overRides);}});}else{aa.chatInProgress=true;f.publish({eventName:"onLoad",data:{API:"Chat API SDK Loaded",version:ac,state:(g?K.chatStates.RESUMING:K.chatStates.UNINITIALISED)}});if(aj.overRides){b(aj.overRides);}Y({success:function(){V.addRels({link:[{rel:"location",href:aj.chatRel}]},{type:"chat"});H(p(K.chatStates.RESUMING,new Date()));X(null,aj.overRides);}});}}}function R(an,am){var ao=["lpNumber","appKey","sessionUID"];var aj=true;for(var al=0;al<ao.length;al++){var ak=ao[al];if(an[ak]!=am[ak]){if(ak==="sessionUID"){if(an[ak]&&am[ak]){aj=false;}}else{aj=false;}}if(!aj){break;}}return aj;}function w(an,ap,ao,ak,al,aj){e(s.ERROR,{originalRequest:an,sentRequest:ap,response:ao});ao=ah.getErrorData(ao,al,an);ak=ak.constructor===Array?ak:[ak];for(var am=0;am<ak.length;am++){f.publish({eventName:ak[am],appName:aj||"",data:ao});}ah.runErrorCallback(an,ao);ap=null;}function Z(ak){var aj={site:ak.lpNumber};aj.success=function(al){ak.domain=al.domain;Y(ak);};aj.error=function(al){ab({error:"unable to resolve site domain"},ak,"",al);w({},{},{},"onInit","unable to initiate session");ah.runErrorCallback(ak);};K.getSiteDomain(aj);}K.getSiteDomain=function(am){var al="https://api.liveperson.net/csdr/account/";var aj="/service/adminArea/baseURI.lpCsds?version=1.0";if(typeof am.success!=="function"||!am.site){return ab({error:"missing callback or site - cannot lookup domain"},"","","");}var ak={url:al+am.site+aj};ak.success=function(aq){var ap;e(s.INFO,{originalRequest:{site:am.site},sentRequest:ak,response:aq});if(aq&&aq.ResultSet&&aq.ResultSet.lpData){var ao=aq.ResultSet.lpData;for(var an=0;an<ao.length;an++){if(!ap&&ao[an]["lpServer"]){ap=ao[an]["lpServer"];}}}ak=null;if(ap){ah.runSuccessCallback(am,{domain:ap,site:am.site});}else{ah.runErrorCallback(am,{error:"unable to resolve site domain",response:aq,site:am.site});}};ak.error=ak.success;e(s.INFO,{originalRequest:{site:am.site},sentRequest:ak,response:"SENDING REQUEST"});return l.issueCall(ak);};function Y(aj){aj=aj||{};b(aj);aj.lpNumber=d.lpNumber;aj.appKey=d.appKey;aj.domain=d.domain;if(!aj.lpNumber){return ab({error:"missing site configuration data, cannot init"},aj,"","");}if(!aj.domain){Z(aj);return false;}if(!P()){return false;}V.setData(aj);var ak=V.buildRequestObj({rel:"",data:{lpNumber:d.lpNumber,appKey:d.appKey,domain:d.domain}});ak.success=function(al){e(s.INFO,{originalRequest:aj,sentRequest:ak,response:al});if(al){V.addRels(al,{type:"chat"});m("self",{type:"chat",ignoreParameters:true},[{rel:"OTK",href:"chat/resumeWithOTK"}]);f.publish({eventName:"onInit",data:{account:aj.lpNumber,domain:aj.domain,init:true}});H(p(K.chatStates.INITIALISED));}if(aj.requestChat){K.requestChat(aj);}else{ah.runSuccessCallback(aj,{});}ak=null;};ak.error=function(am){var al=["onInit"];if(aj.requestChat){al.push("onRequestChat");}w(aj,ak,am,al,"unable to initiate session");V.clearData();};e(s.INFO,{originalRequest:aj,sentRequest:ak,response:"SENDING REQUEST"});return A.issueCall(ak);}K.requestChat=function(aj){if(aa.initialised){i(aj);}else{aj=aj||{};aj.requestChat=true;aj.lpNumber=ae.lpNumber;aj.appKey=ae.appKey;aj.domain=(ae.domain||null);aj.clearDomain=true;Y(aj);}};K.startChat=K.requestChat;function n(ak){var am={},al=false,ap;if(ak.agent){ah.deleteProps(ak,["skill","serviceQueue","maxWaitTime"]);am.agent=ak.agent;al=true;}else{if(ak.skill){am.skill=ak.skill;ah.deleteProps(ak,["serviceQueue","maxWaitTime"]);al=true;}else{if(ak.serviceQueue&&!isNaN(ak.maxWaitTime)){am.serviceQueue=ak.serviceQueue;am.maxWaitTime=ak.maxWaitTime;al=true;}}}if(typeof ak.buttonName==="string"){am.chatReferrer="(button dynamic-button:"+ak.buttonName+"()) "+document.location.href;al=true;}else{if(ak.invitation===true){am.chatReferrer="(engage) "+document.location.href;al=true;}else{if(ak.chatReferrer||document.referrer){am.chatReferrer=ak.chatReferrer||document.referrer;al=true;}}}if(navigator&&navigator.userAgent){am.userAgent=navigator.userAgent;al=true;}if(typeof ak.ssoKey==="string"){am.ssoKey=ak.ssoKey;al=true;}if(typeof ak.survey==="object"){am.survey=ak.survey;al=true;}if(ak.a2aSourceSiteId){am.a2aSourceSiteId=ak.a2aSourceSiteId;al=true;}if(ak.a2aSourceSessionId){am.a2aSourceSessionId=ak.a2aSourceSessionId;al=true;}if(ak.a2aEventId){am.a2aEventId=ak.a2aEventId;al=true;}if(typeof ak.LETagVisitorId==="string"){am.LETagVisitorId=ak.LETagVisitorId;al=true;}if(typeof ak.LETagSessionId==="string"){am.LETagSessionId=ak.LETagSessionId;al=true;}if(typeof ak.LETagContextId==="string"){am.LETagContextId=ak.LETagContextId;al=true;}if(ak.runWithRules===true){am.runWithRules=true;al=true;}var ao=ak.visitorId||h.readCookie(W.lpNumber+"-VID");if(ao){am.visitorId=ao;al=true;}var an=ak.visitorSessionId||h.readCookie(W.lpNumber+"-SKEY")||(window.lpMTagConfig&&window.lpMTagConfig.LPSID_VAR);if(an){am.visitorSessionId=an;al=true;}if(typeof ak.customVariables==="object"){if(ak.customVariables.customVariable&&ak.customVariables.customVariable.constructor===Array){am.customVariables=ak.customVariables;al=true;}else{var aj=ag(ak.customVariables);if(aj){am.customVariables=aj;al=true;}}}if(ak.preChatLines&&ak.preChatLines.constructor===Array){am.preChatLines={line:ak.preChatLines};al=true;}if(typeof ak.ssoServiceExtraParams==="string"){am.ssoServiceExtraParams=ak.ssoServiceExtraParams;al=true;}if(typeof ak.ssoServiceKey==="string"){am.ssoServiceKey=ak.ssoServiceKey;al=true;}ap=K.getRtSessionId();if(ap){am.rtSessionId=ap;al=true;}return al?{request:am}:"";}function ag(aj){var al=[];for(var ak in aj){if(aj.hasOwnProperty(ak)){al.push({name:ak,value:aj[ak]});}}if(al.length>0){return{customVariable:al};}else{return null;}}function m(am,ao,an){var aj=V.getURI(am,ao);var ak={link:[]};for(var al=0;al<an.length;al++){ak.link.push({href:aj+"/"+an[al].href,rel:""+an[al].rel});}V.addRels(ak,ao);}function i(ak,aj){if(aa.chatInProgress){return false;}var al=V.buildRequestObj({rel:"chat-request",type:"chat",needAuth:true,requestType:"POST",data:n(ak||{},{})});if(!al){return ab({error:"requestChat - unable to find rel for request"},"","","");}al.success=function(am){e(s.INFO,{originalRequest:(ak||""),sentRequest:al,response:am});if(am&&am.headers&&am.headers.Location){V.addRels({link:[{"@rel":"location","@href":am.headers.Location}]},{type:"chat"});O.storeChatLocationURI(am.headers.Location,aj);if(aj){aa.initialised=false;}X(ak);}al=null;};al.error=function(am){w(ak,al,am,["onRequestChat"],"requestChat  - server error");};e(s.INFO,{originalRequest:(ak||""),sentRequest:al,response:"SENDING REQUEST"});return A.issueCall(al);}function q(ak,aj){if(ak&&!ak.otk){return ab({error:"getSessionDataOTK - missing otk for request, unable to resume"},"","","");}var al=V.buildRequestObj({rel:"OTK",type:"chat",needAuth:true,requestType:"POST",data:{otk:ak.otk,location:window.location.href}});if(!al){return ab({error:"getSessionDataOTK - unable to find rel for request"},"","","");}al.success=function(am){e(s.INFO,{originalRequest:(ak||""),sentRequest:al,response:am});x(al,ak,am);if(aj){aa.initialised=false;}al=null;};al.error=function(am){if(aa.chatState===K.chatStates.RESUMING){H(p(K.chatStates.NOTFOUND));O.sessionEnded();}w(ak,al,am,"onRequestChat","getSessionDataOTK  - server error");};e(s.INFO,{originalRequest:"",sentRequest:al,response:"SENDING REQUEST"});return A.issueCall(al);}function X(ak,aj){var al=V.buildRequestObj({rel:"location",type:"chat",needAuth:true,requestType:"GET"});if(!al){return ab({error:"getSessionData - unable to find rel for request"},"","","");}al.success=function(am){e(s.INFO,{originalRequest:(ak||""),sentRequest:al,response:am});x(al,ak,am);if(aj){aa.initialised=false;}al=null;};al.error=function(am){if(aa.chatState===K.chatStates.RESUMING){H(p(K.chatStates.NOTFOUND));O.sessionEnded();}w(ak,al,am,"onRequestChat","getSessionData  - server error");};e(s.INFO,{originalRequest:"",sentRequest:al,response:"SENDING REQUEST"});return A.issueCall(al);}function x(an,al,am){if(am){V.addRels(am.body.chat,{type:"chat"});V.addRels(am.body.chat.info,{type:"visitor"});var aj=ah.getResponseData(am,"chat",false);f.publish({eventName:"onRequestChat",data:aj});D(aj.info);var ak=r(aj.events);if(ak){J(ak);}ah.runSuccessCallback(al,aj);g=false;}an=null;}K.getAvailableSlots=function(ak){var aj={};if(ak){if(ak.agent&&typeof ak.agent==="string"){aj.agent=ak.agent;}else{if(ak.skill&&typeof ak.skill==="string"){aj.skill=ak.skill;}if(ak.maxWaitTime&&typeof ak.maxWaitTime==="number"){aj.maxWaitTime=ak.maxWaitTime;}}}var al=V.buildRequestObj({rel:"chat-available-slots",type:"chat",needAuth:true,requestType:"GET",queryParams:aj});if(!al){return ab({error:"getAvailableSlots - unable to find rel for request"},"","","");}al.success=function(an){e(s.INFO,{originalRequest:(ak||""),sentRequest:al,response:an});if(an){var am=ah.getResponseData(an,"availableSlots",true);f.publish({eventName:"onAvailableSlots",data:am});ah.runSuccessCallback(ak,am);}al=null;};al.error=function(am){w(ak,al,am,"onAvailableSlots","getAvailableSlots - server error");};e(s.INFO,{originalRequest:(ak||""),sentRequest:al,response:"SENDING REQUEST"});return A.issueCall(al);};K.getEstimatedWaitTime=function(ak){var aj={};if(ak){if(ak.skill&&typeof ak.skill==="string"){aj.skill=ak.skill;}if(ak.serviceQueue&&typeof ak.serviceQueue==="string"){aj.serviceQueue=ak.serviceQueue;}}var al=V.buildRequestObj({rel:"chat-estimatedWaitTime",type:"chat",needAuth:true,requestType:"GET"});if(!al){return ab({error:"getEstimatedWaitTime - unable to find rel for request"},"","","");}al.success=function(an){e(s.INFO,{originalRequest:"",sentRequest:al,response:an});if(an){var am=ah.getResponseData(an,"estimatedWaitTime",true);f.publish({eventName:"onEstimatedWaitTime",data:am});ah.runSuccessCallback(ak,am);}al=null;};al.error=function(am){w(ak,al,am,"onEstimatedWaitTime","getEstimatedWaitTime - server error");};e(s.INFO,{originalRequest:"",sentRequest:al,response:"SENDING REQUEST"});return A.issueCall(al);};K.getAvailabilty=function(ak){var aj={};if(ak){if(ak.agent&&typeof ak.agent==="string"){aj.agent=ak.agent;}else{if(ak.skill&&(typeof ak.skill==="string"||ak.skill.constructor===Array)){aj.skill=ak.skill;}if(ak.maxWaitTime&&typeof ak.maxWaitTime==="number"){aj.maxWaitTime=ak.maxWaitTime;}}}var al=V.buildRequestObj({rel:"chat-availability",type:"chat",needAuth:true,requestType:"GET",queryParams:aj});if(!al){return ab({error:"getAvailability - unable to find rel for request"},"","","");}al.success=function(an){e(s.INFO,{originalRequest:(ak||""),sentRequest:al,response:an});if(an){var am=ah.getResponseData(an,"availability",true);if(am.availability&&am.availability.AvailabilityForSkills&&am.availability.AvailabilityForSkills.skillAvailability){am=T(am.availability.AvailabilityForSkills.skillAvailability);}f.publish({eventName:"onAvailability",data:am});ah.runSuccessCallback(ak,am);}al=null;};al.error=function(am){w(ak,al,am,"onAvailability","getAvailabilty - server error");};e(s.INFO,{originalRequest:(ak||""),sentRequest:al,response:"SENDING REQUEST"});return A.issueCall(al);};K.getAvailability=K.getAvailabilty;function T(al){var ak={};for(var aj=0;aj<al.length;aj++){ak[al[aj].skill]=al[aj].isAvailable;}return ak;}K.disposeVisitor=function(){O.sessionEnded();f.publish({eventName:"onVisitorDisposed",data:{visitorDisposed:true,aSync:true}});};K.getPreChatSurvey=function(ak){var aj={};if(ak){if(ak.visitorProfile&&typeof ak.visitorProfile==="string"){aj.visitorProfile=ak.visitorProfile;}else{if(ak.skill&&typeof ak.skill==="string"){aj.skill=ak.skill;}}}if(ak.visitorIp&&typeof ak.visitorIp==="string"){aj.visitorIp=ak.visitorIp;}if(ak.surveyName&&typeof ak.surveyName==="string"){aj.surveyName=ak.surveyName;}else{if(ak.surveyApiId){aj.surveyApiId=ak.surveyApiId;}}var al=V.buildRequestObj({rel:"prechat-survey",type:"chat",needAuth:true,requestType:"GET",queryParams:aj});if(!al){return ab({error:"getPreChatSurvey - unable to find rel for request"},"","","");}al.success=function(an){e(s.INFO,{originalRequest:(ak||""),sentRequest:al,response:an});if(an){var am=ah.getResponseData(an,"survey",true);f.publish({eventName:"onPreChatSurvey",data:am});ah.runSuccessCallback(ak,am);}al=null;};al.error=function(am){w(ak,al,am,"onPreChatSurvey","getPreChatSurvey - server error");};e(s.INFO,{originalRequest:(ak||""),sentRequest:al,response:"SENDING REQUEST"});return A.issueCall(al);};K.getOfflineSurvey=function(ak){var aj={};if(ak){if(ak.skill&&typeof ak.skill==="string"){aj.skill=ak.skill;}else{if(ak.visitorProfile&&typeof ak.visitorProfile==="string"){aj.visitorProfile=ak.visitorProfile;}else{if(ak.visitorId&&typeof ak.visitorId==="string"){aj.visitorId=ak.visitorId;}else{if(ak.surveyName&&typeof ak.surveyName==="string"){aj.surveyName=ak.surveyName;}else{if(ak.surveyApiId){aj.surveyApiId=ak.surveyApiId;}}}}}}var al=V.buildRequestObj({rel:"chat-offline-survey",type:"chat",needAuth:true,requestType:"GET",queryParams:aj});if(!al){return ab({error:"getOfflineSurvey - unable to find rel for request"},"","","");}al.success=function(an){e(s.INFO,{originalRequest:(ak||""),sentRequest:al,response:an});if(an){var am=ah.getResponseData(an,"survey",true);f.publish({eventName:"onOfflineSurvey",data:am});ah.runSuccessCallback(ak,am);}al=null;};al.error=function(am){w(ak,al,am,"onOfflineSurvey","getOfflineSurvey - server error");};e(s.INFO,{originalRequest:(ak||""),sentRequest:al,response:"SENDING REQUEST"});return A.issueCall(al);};K.submitOfflineSurvey=function(ak){var aj={},al={},an;if(!ak.survey){return ab({error:"Survey must be present in order to submit"},"","","");}else{al.survey=ak.survey;}an=ak.visitorSessionId||h.readCookie(W.lpNumber+"-SKEY")||(window.lpMTagConfig&&window.lpMTagConfig.LPSID_VAR);if(an){al.survey.visitorSessionId=an;}if(typeof ak.LETagVisitorId==="string"){al.survey.LETagVisitorId=ak.LETagVisitorId;}if(typeof ak.LETagSessionId==="string"){al.survey.LETagSessionId=ak.LETagSessionId;}if(typeof ak.LETagContextId==="string"){al.survey.LETagContextId=ak.LETagContextId;}var am=ak.visitorId||h.readCookie(W.lpNumber+"-VID");if(am){al.survey.visitorId=am;}var ao=V.buildRequestObj({rel:"chat-offline-survey",type:"chat",needAuth:true,requestType:"PUT",data:al});if(!ao){return ab({error:"submitOfflineSurvey - unable to find rel for request"},"","","");}ao.success=function(aq){e(s.INFO,{originalRequest:(ak||""),sentRequest:ao,response:aq});if(aq){var ap=ah.getResponseData(aq);f.publish({eventName:"onSubmitOfflineSurvey",data:ap});ah.runSuccessCallback(ak,ap);}ao=null;};ao.error=function(ap){w(ak,ao,ap,"onSubmitOfflineSurvey","submitOfflineSurvey - server error");};e(s.INFO,{originalRequest:(ak||""),sentRequest:ao,response:"SENDING REQUEST"});return A.issueCall(ao);};function a(aj){var ak=V.buildRequestObj({rel:"next",type:"chat",needAuth:true,requestType:"GET"});if(!ak){return ab({error:"getEvents - unable to find rel for request"},"","","");}ak.timeout=10000;ak.retries=0;ak.success=function(am){ad=0;var an,al;e(s.INFO,{originalRequest:"",sentRequest:ak,response:am});if(am){V.addRels(am.body.chat,{type:"chat"});V.addRels(am.body.chat.info,{type:"visitor"});an=ah.getResponseData(am,"chat");al=r(an.events);if(al){J(al);}if(an.info){D(an.info);}}ah.runSuccessCallback(aj,al);ak=null;};ak.error=function(al){ad=ad+1;w(aj,ak,al,["onLine","onAgentTyping","onInfo","onEvents"],"getEvents - server error");if(ad>L){H(p(K.chatStates.NOTFOUND));}};e(s.INFO,{originalRequest:"",sentRequest:ak,response:"SENDING REQUEST"});return A.issueCall(ak);}function J(aj){if(aj.line){f.publish({eventName:"onLine",data:{lines:aj.line}});}if(aj["a2a-transfer"]){var ak=t(aj["a2a-transfer"]);f.publish({eventName:"onAccountToAccountTransfer",data:ak});}if(aj.collaboration){f.publish({eventName:"onCollaboration",data:{collaboration:aj.collaboration}});}if(aj.state){aj.state=aj.state.constructor===Array?aj.state.pop():aj.state;H(p(aj.state.state,aj.state.time));}f.publish({eventName:"onEvents",data:aj});}function t(aj){if(aj.length>1){return aj[aj.length-1];}else{return aj[0];}}function p(aj,ak){return{state:aj,time:ak||new Date().toTimeString()};}function D(al){if((al.agentTyping==="typing")!=aa.agentTyping){aa.agentTyping=(al.agentTyping==="typing");f.publish({eventName:"onAgentTyping",data:{agentTyping:aa.agentTyping}});al.agentTyping=null;delete al.agentTyping;}var ak=false;for(var aj in al){if(al.hasOwnProperty(aj)&&aa.hasOwnProperty(aj)&&(al[aj]!=aa[aj])){if(aj!=="lastUpdate"&&aj!=="agentTyping"&&aj!=="visitorTyping"&&aj!=="state"){aa[aj]=al[aj];ak=true;}}}aa.lastUpdate=al.lastUpdate;if(ak){f.publish({eventName:"onInfo",data:aa,cloneEventData:true});}}function H(aj){if(aa.chatState===aj.state){return;}else{aa.chatState=aj.state;}switch(aj.state){case K.chatStates.ENDED:f.publish({eventName:"onStop",data:aj});break;case K.chatStates.CHATTING:f.publish({eventName:"onStart",data:aj});break;}f.publish({eventName:"onState",data:aj});}function r(am){if(!am.event){return null;}am=am.event;am=am.constructor===Array?am:[am];var ao={};var an=false;for(var aj=0;aj<am.length;aj++){var ak=am[aj].type||am[aj]["@type"];if(am[aj]["channelID"]){var al=am[aj]["channelID"];ao[ak]=ao[ak]||{};ao[ak][al]=ao[ak][al]||[];ao[ak][al].push(am[aj]);}else{ao[ak]=ao[ak]||[];ao[ak].push(am[aj]);}an=true;}return(!an?null:ao);}K.setCustomVariable=function(aj){if(!aj.customVariable){return ab({error:"setCustomVariable - no variables passed in"},"","","");}else{var al=ag(aj.customVariable);if(al&&al.customVariable){aj.customVariable=al.customVariable;}else{return ab({error:"setCustomVariable - unable to find any custom variables to set"},"","","");}}var ak=V.buildRequestObj({rel:"custom-variables",type:"chat",needAuth:true,requestType:"PUT",data:{customVariables:{customVariable:aj.customVariable}}});if(!ak){return ab({error:"setCustomVariable - unable to find rel for request"},"","","");}ak.success=function(an){e(s.INFO,{originalRequest:(aj||""),sentRequest:ak,response:an});if(an){var am={customVariable:aj.customVariable};f.publish({eventName:"onSetCustomVariable",data:am});ah.runSuccessCallback(aj,am);}ak=null;};ak.error=function(am){w(aj,ak,am,"onSetCustomVariable","setCustomVariable  - server error");};e(s.INFO,{originalRequest:(aj||""),sentRequest:ak,response:"SENDING REQUEST"});return A.issueCall(ak);};K.requestTranscript=function(ak){var aj=new RegExp(/[a-zA-Z0-9.-_]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i);if(typeof ak==="string"){ak={email:ak};}if(!ak.email||!aj.test(ak.email)){return ab({error:"requestTranscriptEmail - no variables passed in or invalid email"},"","","");}var al=V.buildRequestObj({rel:"transcript-request",type:"chat",needAuth:true,requestType:"PUT",data:{email:ak.email}});if(!al){return ab({error:"requestTranscript - unable to find rel for request"},"","","");}al.success=function(an){e(s.INFO,{originalRequest:(ak||""),sentRequest:al,response:an});if(an){var am={email:ak.email};f.publish({eventName:"onTranscript",data:am});ah.runSuccessCallback(ak,am);}al=null;};al.error=function(am){w(ak,al,am,"onTranscript","requestTranscriptEmail  - server error");};e(s.INFO,{originalRequest:(ak||""),sentRequest:al,response:"SENDING REQUEST"});return A.issueCall(al);};K.getExitSurvey=function(ak){var aj={};if(ak&&ak.surveyName){aj.surveyName=ak.surveyName;}else{if(ak&&ak.surveyApiId){aj.surveyApiId=ak.surveyApiId;}}var al=V.buildRequestObj({rel:"exit-survey",type:"chat",needAuth:true,requestType:"GET",queryParams:aj});if(!al){return ab({error:"getExitSurvey - unable to find rel for request"},"","","");}al.success=function(an){e(s.INFO,{originalRequest:(ak||""),sentRequest:al,response:an});var am={};if(an&&an.body&&an.body.survey){aa.exitSurveyOn=true;O.changeKeepAliveState();am=ah.getResponseData(an,"survey",true);f.publish({eventName:"onExitSurvey",data:am});ah.runSuccessCallback(ak,am);}al=null;};al.error=function(am){aa.exitSurveyOn=false;O.changeKeepAliveState();w(ak,al,am,"onExitSurvey","getExitSurvey  - server error");};e(s.INFO,{originalRequest:(ak||""),sentRequest:al,response:"SENDING REQUEST"});return A.issueCall(al);};K.submitExitSurvey=function(aj){var ak={};if(!aj.survey){return ab({error:"submitExitSurvey - no survey passed in"},"","","");}if(aj.survey.survey){ak.survey=aj.survey.survey;}else{ak.survey=aj.survey;}if(document.referrer){ak.survey.chatReferrer=document.referrer;}if(navigator&&navigator.userAgent){ak.survey.userAgent=navigator.userAgent;}var al=V.buildRequestObj({rel:"exit-survey",type:"chat",needAuth:true,requestType:"PUT",data:ak});if(!al){return ab({error:"submitExitSurvey - unable to find rel for request"},"","","");}al.success=function(an){e(s.INFO,{originalRequest:(aj||""),sentRequest:al,response:an});aa.exitSurveyOn=false;O.changeKeepAliveState();if(an){var am=ah.getResponseData(an);f.publish({eventName:"onSubmitExitSurvey",data:am});ah.runSuccessCallback(aj,am);}al=null;};al.error=function(am){w(aj,al,am,"onSubmitExitSurvey","submitExitSurvey  - server error");};e(s.INFO,{originalRequest:(aj||""),sentRequest:al,response:"SENDING REQUEST"});return A.issueCall(al);};K.addLine=function(aj){if(!aj){return ab({error:"No object data passed"},"","","");}if(!aj.text){return ab({error:"No text to send"},aj,"","");}var ak=V.buildRequestObj({rel:"events",needAuth:true,type:"chat",requestType:"POST",data:{event:{"@type":"line",text:aj.text}}});if(!ak){return ab({error:"addLine - unable to find rel for request"},aj,"","");}ak.success=function(am){e(s.INFO,{originalRequest:aj,sentRequest:ak,response:am});if(am){var al={text:aj.text};f.publish({eventName:"onAddLine",data:al});ah.runSuccessCallback(aj,al);}ak=null;};ak.error=function(al){w(aj,ak,al,"onAddLine","addLine  - server error");};e(s.INFO,{originalRequest:aj,sentRequest:ak,response:"SENDING REQUEST"});return A.issueCall(ak);};K.setVisitorTyping=function(aj){if(!aj){return ab({error:"No object data passed"},"","","");}if(typeof aj.typing!=="boolean"||aj.typing==aa.typing){return ab({error:"setVisitorTyping typing status missing, not a boolean or unchanged from previous update"},aj,"","");}else{aa.typing=aj.typing;}var ak=V.buildRequestObj({rel:"visitor-typing",needAuth:true,type:"visitor",requestType:"PUT",data:{visitorTyping:(aj.typing?"typing":"not-typing")}});if(!ak){return ab({error:"setVisitorTyping - unable to find rel for request"},aj,"","");}ak.success=function(am){e(s.INFO,{originalRequest:aj,sentRequest:ak,response:am});if(am){var al={typing:aj.typing};f.publish({eventName:"onSetVisitorTyping",data:al});ah.runSuccessCallback(aj,al);}ak=null;};ak.error=function(al){w(aj,ak,al,"onSetVisitorTyping","setVisitorTyping  - server error");};e(s.INFO,{originalRequest:aj,sentRequest:ak,response:"SENDING REQUEST"});return A.issueCall(ak);};K.endChat=function(ak){var aj;var al=V.buildRequestObj({rel:"events",type:"chat",needAuth:true,requestType:"POST",data:{event:{"@type":"state",state:K.chatStates.ENDED}}});if(!al||!aa.chatInProgress){return ab({error:"endChat - unable to find rel for request, or chat not active"},ak,"","");}al.success=function(an){e(s.INFO,{originalRequest:ak,sentRequest:al,response:an});if(an){var am=p(K.chatStates.ENDED);H(am);ah.runSuccessCallback(ak,am);}al=null;};al.error=function(am){w(ak,al,am,["onState"],"endChat - server error");};if(ak&&ak.disposeVisitor){K.disposeVisitor();}e(s.INFO,{originalRequest:ak,sentRequest:al,response:"SENDING REQUEST"});return A.issueCall(al);};K.setVisitorName=function(ak){if(!ak){return ab({error:"No object data passed"},"","","");}var aj="";if(typeof ak.visitorName!=="string"||ak.visitorName==aa.visitorName){return ab({error:"setVisitorName missing visitorName or unchanged from previous update"},ak,"","");}else{aj=aa.visitorName;aa.visitorName=ak.visitorName;}var al=V.buildRequestObj({rel:"visitor-name",needAuth:true,type:"visitor",requestType:"PUT",data:{visitorName:ak.visitorName}});if(!al){return ab({error:"setVisitorName - unable to find rel for request"},ak,"","");}al.success=function(an){e(s.INFO,{originalRequest:ak,sentRequest:al,response:an});if(an){var am={visitorName:ak.visitorName};f.publish({eventName:"onVisitorName",data:am});ah.runSuccessCallback(ak,am);}al=null;};al.error=function(am){aa.visitorName=aj;w(ak,al,am,"onVisitorName","setVisitorName  - server error");};e(s.INFO,{originalRequest:ak,sentRequest:al,response:"SENDING REQUEST"});return A.issueCall(al);};K.getAgentTyping=function(){return aa.agentTyping;};K.getVisitorName=function(){return aa.visitorName;};K.getState=function(){return aa.state;};K.getAgentLoginName=function(){return aa.agentName;};K.getAgentId=function(){return aa.agentId;};K.getRtSessionId=function(){return aa.rtSessionId;};K.getConfig=function(){var ak={};for(var aj in W){if(W.hasOwnProperty(aj)){ak[aj]=W[aj];}}return ak;};K.getSessionKey=function(){return aa.chatSessionKey;};K.onLoad=function(al,aj,ak){return j("onLoad",al,aj||"",ak);};K.onInit=function(al,aj,ak){return j("onInit",al,aj||"",ak);};K.onStart=function(al,aj,ak){return j("onStart",al,aj||"",ak);};K.onRequestChat=function(al,aj,ak){return j("onRequestChat",al,aj||"",ak);};K.onTransferChat=function(al,aj,ak){return j("onTransferChat",al,aj||"",ak);};K.onAvailableSkills=function(al,aj,ak){return j("onAvailableSkills",al,aj||"",ak);};K.onAvailability=function(al,aj,ak){return j("onAvailability",al,aj||"",ak);};K.onEstimatedWaitTime=function(al,aj,ak){return j("onEstimatedWaitTime",al,aj||"",ak);};K.onAgentTyping=function(al,aj,ak){return j("onAgentTyping",al,aj||"",ak);};K.onUrlPush=function(al,aj,ak){return j("onUrlPush",al,aj||"",ak);};K.onLine=function(al,aj,ak){return j("onLine",al,aj||"",ak);};K.onInfo=function(al,aj,ak){return j("onInfo",al,aj||"",ak);};K.onEvents=function(al,aj,ak){return j("onEvents",al,aj||"",ak);};K.onState=function(al,aj,ak){return j("onState",al,aj||"",ak);};K.onStop=function(al,aj,ak){return j("onStop",al,aj||"",ak);};K.onResume=function(al,aj,ak){return j("onResume",al,aj||"",ak);};K.onAccountToAccountTransfer=function(al,aj,ak){return j("onAccountToAccountTransfer",al,aj||"",ak);};K.onAddLine=function(al,aj,ak){return j("onAddLine",al,aj||"",ak);};K.onVisitorName=function(al,aj,ak){return j("onVisitorName",al,aj||"",ak);};K.onSetVisitorTyping=function(al,aj,ak){return j("onSetVisitorTyping",al,aj||"",ak);};K.onEstimatedChatWaitTime=function(al,aj,ak){return j("onEstimatedChatWaitTime",al,aj||"",ak);};K.onAvailableSlots=function(al,aj,ak){return j("onAvailableSlots",al,aj||"",ak);};K.onTranscript=function(al,aj,ak){return j("onTranscript",al,aj||"",ak);};K.onPreChatSurvey=function(al,aj,ak){return j("onPreChatSurvey",al,aj||"",ak);};K.onOfflineSurvey=function(al,aj,ak){return j("onOfflineSurvey",al,aj||"",ak);};K.onSubmitOfflineSurvey=function(al,aj,ak){return j("onSubmitOfflineSurvey",al,aj||"",ak);};K.onExitSurvey=function(al,aj,ak){return j("onExitSurvey",al,aj||"",ak);};K.onLog=function(al,aj,ak){return j("onLog",al,aj||"",ak);};K.onVisitorDisposed=function(al,aj,ak){return j("onVisitorDisposed",al,aj||"",ak);};K.onError=function(al,aj,ak){return j("onError",al,aj||"",ak);};K.unbind=function(ak,aj,am,al){return N(ak,aj,am,al);};v(ae);};lpTag.taglets.ChatOverRestAPI.prototype.chatStates={CHATTING:"chatting",WAITING:"waiting",ENDED:"ended",RESUMING:"resume",UNINITIALISED:"uninitialised",INITIALISED:"initialised",NOTFOUND:"notfound"};lpTag.taglets.ChatOverRestAPI.prototype.connectionStates={ACTIVE:"active",INACTIVE:"inactive"};